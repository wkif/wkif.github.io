<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>后端框架学习-Django | Kifroom</title><meta name="keywords" content="Django,Python"><meta name="author" content="kif"><meta name="copyright" content="kif"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="后端框架学习-Django"><meta name="application-name" content="后端框架学习-Django"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="后端框架学习-Django"><meta property="og:url" content="https://wkif.gitee.io/post/9108.html"><meta property="og:site_name" content="Kifroom"><meta property="og:description" content="基本介绍Django 是一个由 Python 编写的一个开放源代码的 Web 应用框架。 使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务 Django 本身基于 MVC 模型，即 Model（模型）"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforhexo/882690e66cdd6486c7ced449245fe620.jpg"><meta property="article:author" content="kif"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforhexo/882690e66cdd6486c7ced449245fe620.jpg"><meta name="description" content="基本介绍Django 是一个由 Python 编写的一个开放源代码的 Web 应用框架。 使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务 Django 本身基于 MVC 模型，即 Model（模型）"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://wkif.gitee.io/post/9108"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":null},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: kif","link":"链接: ","source":"来源: Kifroom","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Kifroom',
  title: '后端框架学习-Django',
  postAI: '',
  pageFillDescription: '基本介绍, 特点, MVC 与 MTV模型, MVC 模型, MTV 模型, 创建项目, 使用命令行创建项目, 创建项目, 启动服务（测试用前台启动）, 关闭服务, 启动应用, 列出所有的命令, 生成数据库迁移文件, 执行数据库迁移, 进入 Django Shell, 创建admin, 清理已过期Sessions, 生成requirements.txt；, 创建内存表, settings.py, URL, 视图函数, 路由配置, HTTP请求, 请求x2F响应, GET请求和POST请求, CSRF验证问题, Django的设计模式, Django模板层, 模板层创建, 模板的变量, 模板层的标签, 模板层过滤器, 模板的继承, url反向解析, 静态文件, 应用, 应用创建, 分布式路由, 应用下的模板, 模型层及ORM介绍, ORM框架, 模型类, 模型类-字段类型：, 模型类-字段选项：, 模型类-Meta内部类, ORM-创建数据, ORM, 查询操作, 查询谓词, 更新操作, 删除操作, F对象, Q对象, 聚合查询, 原生数据库操作：, admin后台管理, 后台的创建：, 注册自定义模型类, 模型管理器类, 关系映射, 一对一映射, 一对多查询, 多对多映射, Cookies和Session, 会话, Cookies, session, 缓存, Django中设置缓存：(settings.py), 整体缓存策略, 局部缓存策略, 浏览器缓存策略-强缓存, 浏览器缓存策略-协商缓存, 中间件, 中间件方法, 编写中间件, CSRF - 跨站伪造请求攻击, 分页, paginator对象, page对象, csv文件, python中生成csv文件, csv文件下载, 内建用户系统, 文件上传, 上传规范-前端, 上传规范-后端, django发送邮件, 邮件相关协议, Django发邮件, 项目部署, uWSGI基本介绍是一个由编写的一个开放源代码的应用框架使用只要很少的代码的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容并进一步开发出全功能的服务本身基于模型即模型视图控制器设计模式模式使后续对程序的修改和扩展简化并且使程序某一部分的重复利用成为可能优势低耦合开发快捷部署方便可重用性高维护成本低加是快速开发设计部署网站的最佳组合特点强大的数据库功能自带强大的后台功能优雅的网址与模型模型模式是软件工程中的一种软件架构模式把软件系统分为三个基本部分模型视图和控制器以一种插件式的松耦合的方式连接在一起模型编写程序应有的功能负责业务对象与数据库的映射视图图形界面负责与用户的交互页面控制器负责转发请求对请求进行处理简易图用户操作流程图模型的模式本质上和是一样的也是为了各组件间保持松耦合关系只是定义上有些许不同的分别是指表示模型编写程序应有的功能负责业务对象与数据库的映射表示模板负责如何把页面展示给用户表示视图负责业务逻辑并在适当时候调用和除了以上三层之外还需要一个分发器它的作用是将一个个的页面请求分发给不同的处理再调用相应的和的响应模式如下所示简易图用户操作流程图解析用户通过浏览器向我们的服务器发起一个请求这个请求会去访问视图函数如果不涉及到数据调用那么这个时候视图函数直接返回一个模板也就是一个网页给用户如果涉及到数据调用那么视图函数调用模型模型去数据库查找数据然后逐级返回视图函数把返回的数据填充到模板中空格中最后返回网页给用户创建项目使用命令行创建项目项目名称使用创建项目选择配置路径和项目名称配置环境默认用系统环境点击完成创建项目目录介绍项目的目录项目目录配置文件路由系统与视图的对应关系命令就使用模块做简单的管理文件创建应用使用命令行模式创建应用在中输入应用名使用创建应用注意使用命令行创建的应用一定要在中加入你的应用名字进行注册使用创建的应用则不用认识应用结构运行项目使用命令行运行项目指定端口注意要在同级目录执行命令启动项目点击右上角的绿色的三角按钮如需更改配置信息请下拉选择进行配置配置完以上信息之后直接按运行一下文件出现如下结果表示配置成功创建项目项目名称启动服务测试用前台启动端口号关闭服务在终端启动应用列出所有的命令生成数据库迁移文件执行数据库迁移进入创建清理已过期生成创建内存表包含项目管理的子命令项目同名文件夹包的初始化文件网关的配置文件正式启动时才需要用到项目主路由配置请求进入有限调用项目的配置文件包含项目启动需要的配置公有配置和自定义配置配置项格式例公有配置官方提供的基础配置自定义配置满足命名规则并尽量个性化项目的绝对路径启动模式调试模式检测代码改动后立即重启服务报错后提供一个正式启动模式上线模式请求头只处理请求头在在列表中的请求过滤一些请求在调试模式下默认接收和两个值局域网内部访问时需要把局域网加上一旦不为空就必须都配置上主路由文件位置语言配置时区统一资源定位符协议主机端口路由查询字符串锚点协议加密安全的本地磁盘协议依靠解析为端口默认为端口路由地址查询字符串主要用于给动态网页传递参数样式参数值参数值信息片段锚点直接定位到网页指定位置如何处理从配置文件中根据找到主路由文件默认加载变量包含很多数组的路由依次匹配的匹配到第一个合适的中断后续匹配匹配成功返回响应匹配失败返回视图函数用于接收浏览器请求并通过对象返回响应的函数此函数可以接收浏览器请求并根据业务逻辑返回相应的响应内容给浏览器语法其他参数对象书写位置项目同名文件夹下这是一个页面路由配置函数字符串类型匹配的请求路径指定路径所处理的视图处理函数的名称地址别名转化器转换器转换器类型自定义名作用若转换器类型匹配到对应类型的数据则将数据按照关键字传参的方式传递给视图函数转换器匹配除了之外的非空字符串匹配或任何正整数匹配任何由字母或数字以及连字符和下划线组成的短标签匹配非空字段包括路径分隔符函数正则匹配更加精密的匹配规则正则表达式为命名分组模式请求请求浏览器通过协议发送给服务器端的数据响应服务器端接收到请求后做相应的处理后再回复给浏览器端的数据起始行方法路由协议请求头请求体可能为空请求方法返回实体主体调试获取报头向指定资源提交数据进行处理更新删除代理服务器回显主要用于测试和诊断中的请求实际就是视图函数的第一个参数及对象个人理解就是预先将请求转变为了对象将请求内容转变为对象属性说到底是对报文进行了预处理字符串表示请求方法拿查询字符串后的值查询字典的对象拿表单里的数据即用户提交的数据查询字典的对象类似于字典的对象拿文件请求头请求响应起始行协议版本状态码响应头响应体响应状态码请求成功内部服务器错误永久重定向临时重定向请求的资源不存在分类收到请求需要继续执行操作成功操作被成功接收并处理重定向客户端错误服务器错误的响应对象响应体响应体数据类型状态码作用向客户端浏览器返回响应同时携带响应体内容常用请求和请求统一由视图函数接收因此一定是需要隔离业务逻辑处理业务逻辑处理的业务逻辑其他业务逻辑处理一般用于向服务器获取数据能够产生请求的场景浏览器地址栏输入并回车地址参数值参数值表单中的为请求方法中如果有数据需要传递给服务器通常会使用查询字符串传递注意不要传递敏感数据服务器端接收参数获取客户端请求请求提交的数据参数名参数名默认值参数名如果有传递多个值则参数对应的应该是一个列表需要使用方法取出所有值方法只能取出最后一个值应用场景问卷调查的复选框处理一般用于向服务器提交大量隐私数据通过表单姓名登录验证问题本身是的防御措施防御攻击问题会阻止暂时关闭注释的设计模式传统的模型视图控制器模式特点低耦合模型层主要用于对数据库层的封装视图层用于给用户展示结果显示什么怎么显示控制层用于处理请求获取数据返回结果模式把的拆成了两层并且弱化层为路由文件模型层与相同模板层专门负责相关事情视图层核心负责接收请求获得结果返回结果在该模式下依然存在控制层即主路由模板层模板层创建模板根据字典数据动态变化的网页根据视图中传递的字典数据动态生成相应的页面模板配置创建模板文件夹项目名在中配置项指定模板引擎模板的搜索目录可以是一个或多个是否在应用中的文件夹中搜索末班文件有关模板的选项主要需要修改的模板加载方案通过加载模板模板文件名将转化为字符串字典数据用响应对象将转换的字符串内容返回给浏览器模板加载方案使用直接加载并且响应模板在视图函数中模板文件名字典数据视图层与模板层之间的交互视图函数中可以将变量封装到字典中传递到模板中模板中使用的语法来调用视图传进来的变量模板的变量能传递到模板中的变量类型在模板中使用变量的语法模板层的标签作用将一些服务器端的功能嵌入到模板中例如流程控制等语法标签结束标签例标签条件表达式条件表达式条件表达式一定记住要封口在模板中使用实际括号是无效的语法如果需要指示优先级则应该选择嵌套标签语法变量可迭代对象循环语句可迭代对象无数据时填充语句内置变量循环的当前迭代从开始索引循环的当前迭代从开始索引倒序倒序第一次循环为真最后一次循环为真外层循环模板层过滤器过滤器在变量输出时对变量的值进行处理可以通过使用过滤器来改变变量的输出显示语法变量过滤器参数过滤器参数值常用过滤器转换为小写转换为大写魔人布对变量内的字符串进行转义将的值增加模板的继承模板继承使父模板内容重用子模板直接继承父模板的全部内容并可以覆盖父模板中相应的块语法父模板中定义父模板中的块标签识别出哪些在子模板是允许被修改的标签在父模板中定义在子模板中覆盖语法子模板中继承模板标签写在模板第一行例如子模板复写父模板中的内容块重写的覆盖规则不重写按照父模板的效果显示重写则按照重写效果显示注意模板继承时服务器的动态内容无法继承反向解析代码中的位置模板超链接表单将表单中的数据用的方法提交到视图函数中跳转将用户地址栏中的地址跳转到代码中的书写规范绝对地址相对地址浏览器会把当前地址栏的协议和端口加上这个地址没有开头的浏览器会根据当前最后一个之前的内容加上该相对地址作为最终访问地址反向解析指在视图或模板中用定义的别名来动态查找或计算出相应的路由别名模板中别名别名参数值参数值视图函数中调用方法进行方向解析别名静态文件什么是静态文件图片音频视频静态文件属于静态请求不经过视图函数静态文件配置静态文件的访问路径默认静态文件在服务器端的存储位置元组方案通过标签访问静态文件加载使用静态资源静态资源路径样例应用应用创建每一个应用都是一个创建应用用执行在的列表中配置安装此应用执行创建应用后应用文件夹下文件夹与有关与相关视图函数分布式路由中主路由配置文件可以不处理用户具体路由主路由配置文件的可以做请求的分发分布式请求处理具体的请求可以由各自的应用来进行处理主路由匹配前缀如再往下分发到子路由配置配置分布式路由主路由中调用函数在子路由下创建其内部结构与主路由完全一致应用下的模板应用内部可以配置模板目录应用下手动创建文件夹中开启应用模板功能配置项中的值为即可查找模板的顺序外层文件夹注册顺序的内部的文件夹解决方法在应用层的下创建嵌套同名子目录从而在中使得获得不一样的路径模型层及介绍模型层负责与数据库之间进行通信配置创建数据库更改什么是模型模型是一个的类它是由派生出的子类一个模型类代表数据库的一张数据表模型类中每一个类属性都代表数据库中的一个字段模型是数据交互的接口是表示和操作数据库的方法和方式框架对象关系映射是一种程序技术能够使用类和对象对数据库进行操作从而避免通过语句操作数据库作用建立模型类和表之间的对应关系允许我们通过面向对象的方式来操作数据库根据设计的模型类生成数据库中的表格通过简单的配置就能更换数据库引擎优点只需要面向对象编程简化了向数据库编写代码的流程实现了数据模型与数据库的解耦屏蔽了不同数据库操作上的差异缺点对于复杂业务使用成本较高根据对象的操作转换为语句根据查询结果转化为对象在映射过程中有性能损失映射图类数据表对象数据行属性字段数据库迁移迁移是同步您对模型所做出的更改添加字段删除模型等到您的数据库模式的方式生成迁移文件生成一个中间文件并保存在文件夹中执行迁移脚本程序执行迁移程序实现迁移将每个应用下的目录中的中间文件同步回数据库模型类模型类创建模型类名字段名字段类型字段选项表名实际为名称类名称小写模型类字段类型数据库类型编程语言中将使用或来表示值在数据库中则使用或来表示具体的值数据库类型不支持注意必须要指定参数值数据库类型作用表示日期参数三选一每次保存对象时自动设置该字段为当前时间取值当兑现第一次被创建时自动设置当前时间取值设置当前时间数据库类型通常用这个比上面那个精确一些作用表示日期和时间参数同数据库类型编程语言中和数据库中都使用小数表示值数据库类型编程语言中使用小数表示该列的值在数据库中使用小数参数必须有数据库类型编程语言和数据库中均使用字符串但含有正则检查数据库类型编程语言和数据库中使用整数数据库类型作用在数据库中为了保存图片路径编程语言和数据库中使用字符串数据库类型作用表示不定长的字符数据模型类字段选项创建列的额外信息设置为则为主键此数据库表不会创建字段设置为则字段可以为空控制的是后台的提交和的不同设置为则该列允许为空默认为需要一个选项来设置默认值设置该列的默认值设置为表示为该列增加索引唯一索引指定列的名称如果不指定的话则采用属性名作为列名不给的话字段名就是列名设置此字段在界面上的显示名称可以中文化界面好习惯字段选项添加或更改均要执行模型类内部类使用类来给模型其实就是表的属性赋予属性类下有很多内建的类属性可对模型类做一些控制如改表名模型类名字段名字段类型字段选项控制模型类在后台显示的名称单数名指定复数形态复数名对于数据库操作是惰性的尽量不对数据库进行积极的修改如设置的值将不参与表的字段生成只会参与实际插值创建数据增删改查核心模型类管理器对象管理器对象每一个的模型类都会有一个对象被同样继承下来这个对象叫做管理器对象数据库的增删改查可以通过管理器实现创建数据方案属性值属性值成功返回创建好的实体对象失败抛出异常方案创建实例对象并调用并保存属性值属性值属性值需要使用代码每次变化都需要重启查询操作通过管理器对象进行通过管理器方法调用查询方法方法用法等价于返回值容器对象类数组对象内部存放了实例如可以在模型类中定义方法自定义中的输出格式则输出时能输出格式化字符串同样支持方法的串联以下方法在返回后均可使用方法串联且最终都会按照顺序对数据库进行操作将取得实际的语句字段字段等价于列列返回但内部存字典每一个字典代表一个数据如字段字段基本同上但返回元组使用时需要使用索引列降序列等价于返回如条件语法属性值属性值默认是查询等价于条件查询返回值存放模型实例条件语法同上等价于作用返回不包含此条件的全部数据集电商取非可以用该语句条件容易报错一定要一下语法条件作用返回满足条件的唯一一条数据说明该方法只能返回一条数据直接获得查询结果多于一条则抛出异常查询结果没有数据则抛出异常查询谓词类属性谓词定义做更灵活的条件查询时需要使用查询谓词说明每一个查询谓词都是一个独立的查询功能等值匹配包含指定值以开始以结束大于指定值大于等于小于小于等于指定范围内中国美国查询数据是否在指定区间范围内更新操作针对单个数据的修改查改通过对象属性的方式更改保存对象批量更新数据直接调用的属性值实现批量修改针对来做更改删除操作单个数据删除查找对应的数据对象调用该数据对象的方法实现删除批量数据删除查找调用方法实现删除伪删除操作通过在表里添加一个布尔型字段默认是执行删除时将欲删除数据的置为注意使用伪删除时确保显示数据的地方均添加了的过滤查询对象对象很适合用于点赞对象实际等价于语句使用单句的数据库查询语句的引擎使用行锁因此对象的本质是使用了数据库中的锁一个对象代表数据库中某条记录的字段的信息不直接取出来作用通常对数据库字段值在不获取的情况下进行操作用于类属性之间的比较列名对数据库字段值在不获取的情况下进行操作例需求将表中所有的全部自增该需求原本只能通过循环取出每一个数据后再写入实现的方法必须结合对象方法实现使用语句用于类属性之间的比较对象用于进行逻辑或逻辑非操作时使用对象能够实现互相间的与或非与非等操作聚合查询聚合查询是指对一个表中的一个字段的数据进行部分或全部进行统计查询分为整表聚合和分组聚合整表聚合聚合函数需要导入语法结果变量名别名聚合函数列返回字典分组聚合其实是为了实现语句通过计算查询结果中每一个对象所关联的对象集合从而得出总计值为查询集的每一项生成聚合结果变量名别名聚合函数列返回原生数据库操作只用来查询语句拼接参数返回值集合对象不支持方法串联只支持基本的循环等注入问题使用原生语句使用拼接参数的方式进行查询能适当避免注入问题完全跨过模型类操作数据库导入用创建类的构造函数创建游标对象为保证在出现异常时能够释放通常用来创建操作执行语句拼接参数后台管理后台用于开发过程中调用和调试会搜集所有已注册的模型类并为这些模型类提供数据管理界面后台的创建注册自定义模型类在应用的导入注册要管理的类调用方法进行注册显示样式是按照中方法显示的模型管理器类作用为后台管理界面添加便于操作的新功能继承于里的类在应用的定义模型管理器类绑定注册模型管理器和模型类使用调用方法的第二个参数类属性表头控制哪些字段超链接进修改页添加过滤器添加搜索框模糊查询添加可在列表页可编辑的字段与字段是互斥的关系映射关系映射一对一一对多多对多一对一映射创建一对一外键语法类名级联删除在存在键的前提下的删除规则级联删除只是模拟约束不影响设置保护删除等同于默认的保留关联数据设置为将外键设置为默认值创建一对一数据无外键的模型类和之前相同有外键的模型类王夫人类属性名称绑实例王夫人类属性字段绑值一对一查询正向查询从外键查对象反向查询从对象查外键调用反向属性查询到关联的一方一对多查询核心正向属性和反向属性在多表上设置外键关联一表创建一对多数据语法一的模型类级联删除在存在键的前提下的删除规则添加数据先添加一再添加多无外键的模型类和之前相同有外键的模型类类似上面王夫人类属性名称绑实例王夫人类属性字段绑值查询数据正向查询有显性属性的由查出版社反向查询使用反向属性或多对多映射核心正向属性和反向属性中多对多需要用三张表实现中无需手动创建第三张表自动完成创建字段语法属性创建数据先创建再关联创建绑定先创建再关联和会话从打开浏览器访问一个网站到关闭浏览器结束此次访问称之为一次会话本身是无状态的导致会话状态难以保持保存在客户端浏览器上的存储空间特点在浏览器是以键值对的形式进行存储的键和值都是以码的形式存储的存储的数据带有生命周期的数据是按照域隔离的不同的域之间无法访问的内部数据会在每次访问此网站时都会携带到服务器如果过大会影响访问速度存储的名字的值存活相对时间秒具体过期时间当不指定和时关闭浏览器时此数据失效删除获取获取删除会话保持登录流程用户登录账号密码传至后端服务器数据库验证正确则发放后续浏览器将自动把当前域下的都发送至服务器但浏览器存储不是十分安全因此引入了技术实际将数据存在了服务器里对于不同的浏览器有不同的存储空间生成空间后会将一个返还给浏览器浏览器会将存储在之后每次返还给服务器是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据初始配置的使用对象是一个类似于字典的类型的对象保存的值到服务器获取的值默认值删除干预时间里的指定中的保存时间默认两周关闭浏览器自动清除默认的数据在中保存在数据库中因此需要保证已经执行过了的问题的表是单表设计且该表数据量不会自动清理哪怕是已经过期可以每晚执行会自动删除已经过期的数据缓存定义缓存是一类可以更快的读取数据的介质统称也指其他可以加快数据读取的存储方式一般用来存储临时数据常用介质的是读取速度很快的内存意义视图渲染有一定成本数据库的频繁查询过高所以对于低频变动的页面可以考虑使用缓存技术减少实际渲染次数用户拿到响应的时间成本会更低场景博客列表页电商商品详情页场景特点数据变动频率较少中设置缓存数据库缓存将缓存存储在数据库中尽管存储介质还是数据库但把一次复杂查询的结果直接存储在表里可避免重复进行复杂查询提升效率配置方法引擎指定用于缓存的表缓存时间最大存储条数缓存条数达到最大值时删除的数据缓存到服务器内存中配置方法引擎雪花算法内存寻址将缓存数据存储到本地文件中配置方法引擎存储路径整体缓存策略视图函数中还是使用了装饰器来实现缓存逻辑单位秒路由中一个道理在进入视图函数前首先使用装饰器换个地方写而已使用简单粗暴但是无法控制局部缓存策略相较于整体缓存更加灵活复用性更好缓存的使用方式使用配置导入具体对象方式直接调用中的值相当于中的缓存存储缓存缓存的字符串类型对象缓存存储时间默认为中的值返回值获取缓存缓存的返回值的对应值没有则返回存储缓存只在不存在的时候生效返回值或浏览器缓存策略强缓存不会向服务器发送请求直接从缓存中读取资源响应头定义缓存过期时间是服务器端的具体的时间点样例响应头秒后缓存失效说明目前服务器都会带着这两个头同时响应给浏览器浏览器优先使用整体缓存自带强缓存功能浏览器缓存策略协商缓存强缓存的对象是一些静态文件大图片等考虑到这类资源比较费带宽且不易变化强缓存到期后浏览器会根服务器进行协商当前缓存是否可用如果可用服务器不必返回数据浏览器继续使用原来缓存的数据如果文件不可用则返回最新数据响应头文件的最近修改时间同时告诉服务器到期后协商请求头浏览器向服务器请求协商如果资源未发生变化则返回响应体为空否则返回代表缓存不可用响应体为最新资源上述的两个头仅通过精确到秒的时间来判断缓存是否有效不是特别精准后来又引入了新的缓存头响应头返回当前资源的唯一标识由服务器生成只要资源变化就会重新生成缓存到期浏览器返回请求头给服务器请求协商服务器比对文件标识不一致则认为资源不可用中间件中间件是请求响应的钩子框架用于全局改变的输入和输出中间件以类的形式体现每个中间件负责一些特定的功能中间件方法继承类中间件类须实现下列五个方法中的一个或多个执行路由之前被调用在每个请求上调用只能返回或对象则通过在视图之前调用在每个请求上调用返回或对象在响应返回浏览器被调用在每个请求调用返回对象当处理过程中抛出异常时调用返回一个对象用来统一抓所有视图函数的异常在响应中包含方法时被调用该方法返回二次封装后的响应对象中间件中的大部分方法返回则表示进入下一项时间返回则被拦截编写中间件注册中间件建立中间件包编写中间件中间件的执行顺序先由上到下在进入视图后变为由下至上跨站伪造请求攻击利用自动提交功能同时利用了表单及一些控件的跨域提交的防御机制页面和都有一个暗号只有两个暗号同时发送到服务器并且能够匹配才允许配置步骤保证打开模板中标签下添加如下标签当个别视图不需要进行保护可以用装饰器关闭对此视图的检查分页分页指在页面有大量数据需要显示为了阅读方便在每个页中只显示部分数据优点方便阅读减少数据提取量减轻服务器压力提供了类可以方便的实现分页功能类位于模块中对象负责分页数据整体的管理需要分页数据的对象列表如分页数据个数返回值对象对象属性需要分页的数据对象总数分页后的页面总数从开始的对象用于记录当前页码数每页数据个数方法对象参数为页码信息从开始返回当前页对应的页信息如果提供的页码不存在抛出异常包含两种异常子类页码不是整数和页码超页对象对象的方法返回对象页码对象属性当前页上所有数据对象的列表当前页面的序号从开始当前对象相关的对象对象方法如果有下一页返回下一页页码如果下一页不存在抛出异常如果有上一页返回返回上一页的页码如果上一页不存在抛出异常如果有上一页或者有下一页返回文件文件逗号分隔值文件其文件以纯文本形式存储表格数据数字或文本说明可被常见制表工具如等直接进行读取中生成文件提供了内建库可直接通过该库操作文件案例指文件输出时换行符怎么处理空字符串将不会转义文件下载在网站中实现下载注意如下响应类型需修改为这告诉浏览器该文档是文件而不是文件响应为额外添加一个标头其中包含文件的名称它将被浏览器用于开启另存为对话框内建用户系统模型类位置中表字段属性用户名密码邮箱名姓是否为超级用户是否为内部员工伪删除上次登陆时间用户创建时间命令创建普通用户主要是需要处理密码将自动转化密码为值用户名密码邮箱创建超级用户删除用户伪删除更新操作校验密码如果用户名密码校验成功则返回用户对象否则返回修改密码登录状态保持只存且时间不可控登录状态校验直接能拿到对象登录状态取消内建用户表扩展字段方案通过建立细腻哦啊和内建表做对映射方案继承抽象模型类方案步骤添加应用定义模型类继承中指明应用名类名注意此操作需要在第一次之前进行在里面添加配置添加用户文件上传定义用户可以通过浏览器将图片等文件传至网站场景上传头像上传流程性的文件上传规范前端上传必须为提交方式表单中文件上传时必须有带有时才会包含文件内容数据表单中用标签上传文件上传规范后端视图函数中需要用取文件框的内容说明的对应页面中框的值绑定文件流对象文件名文件的字节流数据配置文件的访问路径和存储路径在中设置相关配置将用户上传的文件统称为资源同时和还需要手动绑定在主路由添加等价于做了开头的路由接到该特征请求后去路径查找资源文件写入方法可能出现文件名称的重名问题在视图函数中借助字段子目录名建表时增加一个字段即可实际收到后直接在视图函数中将绑定文件流对象扔给对应字段即可该方法若文件名重复则将自动添加后缀发送邮件业务场景业务报警邮件验证密码找回邮件相关协议简单邮件传输协议负责邮件的发送属于推送协议交互式邮件访问协议应用层协议负责本地邮件客户端访问远程服务器上的邮件属于拉取协议邮局协议第个版本是协议族中的一员本协议主要用于支持使用客户端远程管理在服务器上的电子邮件同样属于拉取协议两者均为拉取协议负责从邮件服务器中下载邮件支持摘要浏览功能并且是双向协议客户端操作可以反馈给服务器必须下载全部邮件且为单向协议客户端操作无法同步服务器发邮件中配置邮件功能主要为协议负责发邮件原理给授权一个邮箱用该邮箱给对应收件人发送邮件封装了电子邮件的自动发送协议授权邮箱端修改开启相关的功能获得授权码修改添加引擎写死腾讯邮箱的服务器地址默认指的是授权码与服务器通讯时是否启动连接安全链接默认为安全协议比较耗时发送发送邮箱接受者邮箱列表返回则成功发送通过中间件可以捕获所有视图函数的异常并发送到指定邮箱定位错误位置异常追溯直接获得错误具体位置及出错信息邮箱里可以直接发送自定义收件人在里自定义属性在调用位置自定义属性项目部署在软件开发完毕后将开发机器上运行的软件实际安装到服务器上进行长期运行安装机器上安装和配置同版本的环境数据库等项目迁移第三方工具等直接用命令需要复制文件路径远程路径用替代方法配置反向代理服务器用配置静态文件路径解决静态路径问题服务器网关接口是应用程序或框架和服务器之间的一种接口的一种实现了协议协议协议等多种协议在圈热度极高主要以学习配置为主安装命令可以安装验证安装安装配置项目同名文件夹如文件以开头有如下配置项监听端口套接字方式的地址端口号此模式需要有通信凡是的地址端口号项目当前工作目录绝对路径项目中文件目录相对于当前工作目录相对路径进程个数最多为核数每个进程的线程个数服务的记录文件服务的日志文件位置后台启动以及所有日志位置开启主进程管理模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-31 00:04:59',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.kifroom.icu/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/ico.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://kifnav.kifroom.icu/" title="kifNav"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifnav.kifroom.icu/favicon.ico" alt="kifNav"/><span class="back-menu-item-text">kifNav</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Kifroom</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/links/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/message-board/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/travel/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 游记</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Axios/" style="font-size: 1.05rem;">Axios<sup>3</sup></a><a href="/tags/C-S-N/" style="font-size: 1.05rem;">C.S.N<sup>1</sup></a><a href="/tags/Ckeditor4/" style="font-size: 1.05rem;">Ckeditor4<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>3</sup></a><a href="/tags/Django/" style="font-size: 1.05rem;">Django<sup>1</sup></a><a href="/tags/Excel/" style="font-size: 1.05rem;">Excel<sup>1</sup></a><a href="/tags/Oracle/" style="font-size: 1.05rem;">Oracle<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>1</sup></a><a href="/tags/RSA/" style="font-size: 1.05rem;">RSA<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 1.05rem;">SQL<sup>1</sup></a><a href="/tags/VS-code/" style="font-size: 1.05rem;">VS code<sup>1</sup></a><a href="/tags/Vue-js/" style="font-size: 1.05rem;">Vue.js<sup>2</sup></a><a href="/tags/Win/" style="font-size: 1.05rem;">Win<sup>3</sup></a><a href="/tags/dom-to-image/" style="font-size: 1.05rem;">dom-to-image<sup>1</sup></a><a href="/tags/express/" style="font-size: 1.05rem;">express<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>5</sup></a><a href="/tags/javascript/" style="font-size: 1.05rem;">javascript<sup>7</sup></a><a href="/tags/kali/" style="font-size: 1.05rem;">kali<sup>1</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>1</sup></a><a href="/tags/lerna/" style="font-size: 1.05rem;">lerna<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/matery/" style="font-size: 1.05rem;">matery<sup>2</sup></a><a href="/tags/monorepo/" style="font-size: 1.05rem;">monorepo<sup>1</sup></a><a href="/tags/node-js/" style="font-size: 1.05rem;">node.js<sup>2</sup></a><a href="/tags/pinia/" style="font-size: 1.05rem;">pinia<sup>1</sup></a><a href="/tags/pyqt/" style="font-size: 1.05rem;">pyqt<sup>1</sup></a><a href="/tags/this/" style="font-size: 1.05rem;">this<sup>1</sup></a><a href="/tags/vite/" style="font-size: 1.05rem;">vite<sup>2</sup></a><a href="/tags/vue3/" style="font-size: 1.05rem;">vue3<sup>3</sup></a><a href="/tags/webpack/" style="font-size: 1.05rem;">webpack<sup>1</sup></a><a href="/tags/workspace/" style="font-size: 1.05rem;">workspace<sup>1</sup></a><a href="/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/" style="font-size: 1.05rem;">兼容性<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">开发规范<sup>2</sup></a><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 1.05rem;">微信小程序<sup>4</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size: 1.05rem;">数组<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%AB%99%E4%BE%BF%E7%AD%BE/" style="font-size: 1.05rem;">网站便签<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Django/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Django</span></a><a class="article-meta__tags" href="/tags/Python/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Python</span></a></span></div></div><h1 class="post-title" itemprop="name headline">后端框架学习-Django</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-05-05T14:16:00.000Z" title="发表于 2021-05-05 22:16:00">2021-05-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2022-03-30T16:04:59.245Z" title="更新于 2022-03-31 00:04:59">2022-03-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator"></span><span class="leancloud_visitors" id="/post/9108.html" data-flag-title="后端框架学习-Django"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span class="leancloud-visitors-count" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为北京"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>北京</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforhexo/882690e66cdd6486c7ced449245fe620.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://wkif.gitee.io/post/9108.html"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a><a href="/tags/Django/" tabindex="-1" itemprop="url">Django</a><a href="/tags/Python/" tabindex="-1" itemprop="url">Python</a><h1 id="CrawlerTitle" itemprop="name headline">后端框架学习-Django</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">kif</span><time itemprop="dateCreated datePublished" datetime="2021-05-05T14:16:00.000Z" title="发表于 2021-05-05 22:16:00">2021-05-05</time><time itemprop="dateCreated datePublished" datetime="2022-03-30T16:04:59.245Z" title="更新于 2022-03-31 00:04:59">2022-03-31</time></header><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>Django 是一个由 Python 编写的一个开放源代码的 Web 应用框架。</p>
<p>使用 Django，只要很少的代码，Python 的程序开发人员就可以轻松地完成一个正式网站所需要的大部分内容，并进一步开发出全功能的 Web 服务 Django 本身基于 MVC 模型，即 Model（模型）+ View（视图）+ Controller（控制器）设计模式，MVC 模式使后续对程序的修改和扩展简化，并且使程序某一部分的重复利用成为可能。</p>
<p>MVC 优势：</p>
<ul>
<li>低耦合</li>
<li>开发快捷</li>
<li>部署方便</li>
<li>可重用性高</li>
<li>维护成本低</li>
<li>…</li>
</ul>
<p>Python 加 Django 是快速开发、设计、部署网站的最佳组合。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>强大的数据库功能</li>
<li>自带强大的后台功能</li>
<li>优雅的网址</li>
</ul>
<hr>
<h2 id="MVC-与-MTV模型"><a href="#MVC-与-MTV模型" class="headerlink" title="MVC 与 MTV模型"></a>MVC 与 MTV模型</h2><h3 id="MVC-模型"><a href="#MVC-模型" class="headerlink" title="MVC 模型"></a>MVC 模型</h3><p>MVC 模式（Model–view–controller）是软件工程中的一种软件架构模式，把软件系统分为三个基本部分：模型（Model）、视图（View）和控制器（Controller）。</p>
<p>MVC 以一种插件式的、松耦合的方式连接在一起。</p>
<ul>
<li>模型（M）- 编写程序应有的功能，负责业务对象与数据库的映射(ORM)。</li>
<li>视图（V）- 图形界面，负责与用户的交互(页面)。</li>
<li>控制器（C）- 负责转发请求，对请求进行处理。</li>
</ul>
<p>简易图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172123.png" alt="img"></p>
<p>用户操作流程图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172151.png" alt="img"></p>
<hr>
<h2 id="MTV-模型"><a href="#MTV-模型" class="headerlink" title="MTV 模型"></a>MTV 模型</h2><p>Django 的 MTV 模式本质上和 MVC 是一样的，也是为了各组件间保持松耦合关系，只是定义上有些许不同，Django 的 MTV 分别是指：</p>
<ul>
<li>M 表示模型（Model）：编写程序应有的功能，负责业务对象与数据库的映射(ORM)。</li>
<li>T 表示模板 (Template)：负责如何把页面(html)展示给用户。</li>
<li>V 表示视图（View）：负责业务逻辑，并在适当时候调用 Model和 Template。</li>
</ul>
<p>除了以上三层之外，还需要一个 URL 分发器，它的作用是将一个个 URL 的页面请求分发给不同的 View 处理，View 再调用相应的 Model 和 Template，MTV 的响应模式如下所示：</p>
<p>简易图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172220.png" alt="img"></p>
<p>用户操作流程图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172236.png" alt="img"></p>
<p><strong>解析：</strong></p>
<p>用户通过浏览器向我们的服务器发起一个请求(request)，这个请求会去访问视图函数：</p>
<ul>
<li>a.如果不涉及到数据调用，那么这个时候视图函数直接返回一个模板也就是一个网页给用户。</li>
<li>b.如果涉及到数据调用，那么视图函数调用模型，模型去数据库查找数据，然后逐级返回。</li>
</ul>
<p>视图函数把返回的数据填充到模板中空格中，最后返回网页给用户。</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><h3 id="使用命令行创建项目"><a href="#使用命令行创建项目" class="headerlink" title="使用命令行创建项目"></a>使用命令行创建项目</h3><pre class="line-numbers language-none"><code class="language-none">django-admin startproject 项目名称<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>使用 Pycharm 创建项目</strong></p>
<pre class="line-numbers language-none"><code class="language-none">file ---&gt; new project ---- 选择Django ---&gt; 配置路径和项目名称 ---&gt; 配置环境(默认用系统环境) ----&gt; 点击create(完成创建)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172439.png" alt="img"></p>
<p><strong>项目目录介绍</strong></p>
<pre class="line-numbers language-none"><code class="language-none">|---mysite # 项目的&#x2F;目录 
  |---mysite # 项目目录 
      |---__init__.py 
      |---settings.py # 配置文件 
      |---urls.py # 路由系统 &#x3D;&#x3D;&#x3D;&gt; url与视图的对应关系 
      |---wsgi.py # runserver命令就使用wsgiref模块做简单的web server 
|---manage.py # 管理文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172445.png" alt="img"></p>
<p><strong>创建应用</strong></p>
<p>使用命令行模式创建应用</p>
<p>在 Terminal 中输入 <strong>python manage.py startapp</strong> 应用名:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172450.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172454.png" alt="img"></p>
<p><strong>使用 Pycharm 创建应用</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172459.png" alt="img"></p>
<p><strong>注意：</strong>使用命令行创建的应用，一定要在 <strong>settings.py–&gt;INSTALLED_APPS</strong> 中加入你的应用名字进行注册, 使用Pycharm创建的应用则不用。 认识应用结构</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172504.png" alt="img"></p>
<p><strong>运行项目</strong></p>
<p>使用命令行运行项目：</p>
<pre class="line-numbers language-none"><code class="language-none">python3 manage.py runserver 
manage.py runserver 80      # 指定端口<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>注意：</strong>要在 manage.py 同级目录执行命令。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172517.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172511.png" alt="img"></p>
<p><strong>Pycharm 启动项目</strong></p>
<p>点击右上角的绿色的三角按钮。</p>
<p>如需更改配置信息，请下拉选择 edit configurations，进行配置。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172522.png" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172526.png" alt="img"></p>
<p>配置完以上信息之后，直接按 Ctrl+shift+F10 运行一下 manage.py 文件。</p>
<p>出现如下结果，表示配置成功。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210528172532.png" alt="img"></p>
<h4 id="创建项目-1"><a href="#创建项目-1" class="headerlink" title="创建项目"></a>创建项目</h4><p>django-admin startproject + 项目名称</p>
<h4 id="启动服务（测试用，前台启动）"><a href="#启动服务（测试用，前台启动）" class="headerlink" title="启动服务（测试用，前台启动）"></a>启动服务（测试用，前台启动）</h4><p>python3 manage.py runserver (+端口号&#x2F;default:8000)<br>python3 manage.py runserver 0.0.0.0:8000</p>
<h4 id="关闭服务"><a href="#关闭服务" class="headerlink" title="关闭服务"></a>关闭服务</h4><p>在终端crtl+c<br>sudo lsof -i:8000 -&gt;kill -9ubuntu</p>
<h4 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h4><p>python manage.py startapp</p>
<h4 id="列出所有的命令"><a href="#列出所有的命令" class="headerlink" title="列出所有的命令"></a>列出所有的命令</h4><p>python3 manage.py</p>
<h4 id="生成数据库迁移文件"><a href="#生成数据库迁移文件" class="headerlink" title="生成数据库迁移文件"></a>生成数据库迁移文件</h4><p>python manage.py makemigrations</p>
<h4 id="执行数据库迁移"><a href="#执行数据库迁移" class="headerlink" title="执行数据库迁移"></a>执行数据库迁移</h4><p>python manage.py migrate</p>
<h4 id="进入-Django-Shell"><a href="#进入-Django-Shell" class="headerlink" title="进入 Django Shell"></a>进入 Django Shell</h4><p>python manage.py shell</p>
<h4 id="创建admin"><a href="#创建admin" class="headerlink" title="创建admin"></a>创建admin</h4><p>python manage.py createsuperuser</p>
<h4 id="清理已过期Sessions"><a href="#清理已过期Sessions" class="headerlink" title="清理已过期Sessions"></a>清理已过期Sessions</h4><p>python manage.py clearsessions</p>
<h3 id="生成requirements-txt；"><a href="#生成requirements-txt；" class="headerlink" title="生成requirements.txt；"></a>生成requirements.txt；</h3><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>pip freeze &gt; requirements.txt</p></blockquote>
<h4 id="创建内存表"><a href="#创建内存表" class="headerlink" title="创建内存表"></a>创建内存表</h4><p>python manage.py createcachetable</p>
<p>manage.py 包含项目管理的子命令<br>项目同名文件夹<br><strong>init</strong>:python包的初始化文件<br>wsgi.py:WEB网关的配置文件，正式启动django时才需要用到<br>urls.py:项目主路由配置-HTTP请求进入Django，有限调用<br>settings.py:项目的配置文件-包含项目启动需要的配置。</p>
<h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><ul>
<li>公有配置和自定义配置</li>
<li>配置项格式例： BASE_DIR &#x3D; ‘xxxx’</li>
<li>公有配置：Django官方提供的基础配置</li>
<li>自定义配置满足命名规则，并尽量个性化</li>
</ul>
<p>项目的绝对路径</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>BASE_DIR &#x3D; Path(<strong>file</strong>).resolve().parent.parent</p></blockquote>
<p>启动模式：<br>True调试模式：</p>
<ul>
<li>检测代码改动后，立即重启服务</li>
<li>报错后提供一个</li>
</ul>
<p>False正式启动模式、上线模式</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>DEBUG &#x3D; True</p></blockquote>
<p>请求Host头,只处理请求头在在列表中的请求，过滤一些请求，debug &#x3D; 1在调试模式下默认接收127.0.0.1和localhost两个值。<br>局域网内部访问时需要把局域网IP加上，一旦不为空就必须都配置上</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>ALLOWED_HOSTS &#x3D; []</p></blockquote>
<p>主路由文件位置：</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>ROOT_URLCONF &#x3D; ‘hworld.urls’</p></blockquote>
<p>语言配置：</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>LANGUAGE_CODE &#x3D; ‘en-us’（zh-Hans）</p></blockquote>
<p>时区：</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>TIME_ZONE &#x3D; ‘UTC’（Asia&#x2F;Shanghai）</p></blockquote>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>统一资源定位符（Uniform Resource Locator）</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>protocal(协议)：&#x2F;&#x2F;hostname(主机)[:port(端口)]&#x2F;path(路由)[?query(查询字符串)][#fragment(锚点)]</p></blockquote>
<ul>
<li>协议http；https（加密，安全的https）；file，本地磁盘协议（file：&#x2F;&#x2F;&#x2F;）</li>
<li>hostname:依靠DNS解析为IP</li>
<li>端口：默认http为80端口</li>
<li>路由地址</li>
<li>查询字符串：？menuld&#x3D;634898&amp;version&#x3D;AID9089<br>  主要用于给动态网页传递参数，样式：？参数&#x3D;值&amp;参数&#x3D;值</li>
<li>信息片段：#subject锚点，直接定位到网页指定位置</li>
</ul>
<p>Django如何处理URL?<br>1.从配置文件中根据ROOT_URLCONF找到主路由文件，默认urls.py<br>2.加载urlpatterns变量[包含很多数组的路由]<br>3.<font color = 'red'>依次</font>匹配urlspatterns的path，匹配到第一个合适的中断后续匹配<br>4.匹配成功-返回响应<br>5.匹配失败-返回404</p>
<h2 id="视图函数"><a href="#视图函数" class="headerlink" title="视图函数"></a>视图函数</h2><p>用于接收浏览器请求并通过HttpResponse对象返回响应的函数。此函数可以接收浏览器请求并根据业务逻辑返回相应的响应内容给浏览器。<br>语法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">xxx_view</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token punctuation">,</span>其他参数…<span class="token punctuation">]</span><span class="token punctuation">)</span>：
    <span class="token keyword">return</span> HttpResponse对象<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>书写位置：项目同名文件夹下&#x2F;views.py</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">def</span> <span class="token function">page1_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html <span class="token operator">=</span> <span class="token string">'&lt;h1>这是一个页面&lt;/h1>'</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h3><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>path函数<br>from django.urls import path<br>path(route,views,name &#x3D; None)</p></blockquote>
<ul>
<li>route:字符串类型，匹配的请求路径</li>
<li>views：指定路径所处理的视图处理函数的名称</li>
<li>name：地址别名</li>
</ul>
<p><strong>path转化器</strong></p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>path转换器<br>&lt;转换器类型:自定义名&gt;<br>作用：若转换器类型匹配到对应类型的数据，则将数据按照关键字传参的方式传递给视图函数</p></blockquote>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>path(‘page&#x2F;<a href="int:page">int:page</a>‘,views.xxx)</p></blockquote>
<p>转换器：</p>
<ul>
<li>str：匹配除了’&#x2F;‘之外的非空字符串</li>
<li>int：int匹配0或任何正整数</li>
<li>slug：匹配任何由ASCII字母或数字以及连字符和下划线组成的短标签</li>
<li>path：匹配非空字段，包括路径分隔符‘&#x2F;’</li>
</ul>
<p>re_path函数：<br>正则匹配，更加精密的匹配规则<br>re_path(reg,view,name &#x3D; xx)<br>正则表达式为命名分组模式(?P<name>pattern);</p>
<h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h3><p>1.请求：浏览器通过HTTP协议发送给服务器端的数据<br>2.响应：服务器端接收到请求后做相应的处理后再回复给浏览器端的数据。</p>
<pre class="line-numbers language-none"><code class="language-none">起始行：方法、路由、协议

headers：请求头 K:V

请求体(body)：可能为空<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>请求方法：<ul>
<li>GET：返回实体主体</li>
<li>HEAD:调试获取报头</li>
<li>POST：向指定资源提交数据进行处理</li>
<li>PUT：更新</li>
<li>DELETE：删除</li>
<li>CONNECT:代理服务器</li>
<li>OPTIONS</li>
<li>TRACE：回显，主要用于测试和诊断</li>
</ul>
</li>
</ul>
<p>Django中的请求：<br>实际就是视图函数的第一个参数，及HttpRequest对象<br>个人理解就是Django预先将请求转变为了对象，将请求内容转变为对象属性。说到底是对报文进行了预处理。</p>
<ul>
<li>path_info:URL字符串</li>
<li>method：表示HTTP请求方法</li>
<li>GET：拿查询字符串（？后的值），QueryDict查询字典的对象</li>
<li>POST：拿POST表单里的数据，即用户提交的数据，QueryDict查询字典的对象</li>
<li>FILES：类似于字典的对象，拿文件</li>
<li>COOKIES</li>
<li>session</li>
<li>body</li>
<li>scheme</li>
<li>get_full_path()</li>
<li>META:请求头</li>
</ul>
<h2 id="请求-x2F-响应"><a href="#请求-x2F-响应" class="headerlink" title="请求&#x2F;响应"></a>请求&#x2F;响应</h2><pre class="line-numbers language-none"><code class="language-none">起始行（协议版本 状态码）
响应头(K:V)
响应体body<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>响应状态码：</p>
<ul>
<li>200 请求成功</li>
<li>500 内部服务器错误</li>
<li>301 永久重定向</li>
<li>302 临时重定向</li>
<li>404 请求的资源不存在</li>
</ul>
<p>分类：</p>
<ul>
<li>1**，收到请求，需要继续执行操作</li>
<li>2**，成功，操作被成功接收并处理</li>
<li>3**，重定向</li>
<li>4**，客户端错误</li>
<li>5**，服务器错误</li>
</ul>
<p>Django的响应对象</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>HttpResponse(content &#x3D; 响应体，content_type &#x3D; 响应体数据类型default：html，status &#x3D; 状态码，default：200)<br>作用：向客户端浏览器返回响应，同时携带响应体内容。</p></blockquote>
<p>常用Content_Type</p>
<ul>
<li>‘test&#x2F;html’<br>  ……</li>
</ul>
<h3 id="GET请求和POST请求"><a href="#GET请求和POST请求" class="headerlink" title="GET请求和POST请求"></a>GET请求和POST请求</h3><p>统一由视图函数接收，因此一定是需要隔离业务逻辑</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
    处理GET业务逻辑
<span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span><span class="token string">'POST'</span><span class="token punctuation">:</span>
    处理POST的业务逻辑
<span class="token keyword">else</span><span class="token punctuation">:</span>
    其他业务逻辑
````

<span class="token operator">**</span>GET处理：<span class="token operator">**</span>
一般用于向服务器获取数据。
能够产生GET请求的场景：

<span class="token operator">+</span> 浏览器地址栏输入URL并回车
<span class="token operator">+</span> <span class="token operator">&lt;</span>a href <span class="token operator">=</span> <span class="token string">"地址？参数=值&amp;参数=值"</span>\<span class="token operator">></span>
<span class="token operator">+</span> form表单中的method为get

GET请求方法中，如果有数据需要传递给服务器，通常会使用查询字符串传递。【注意不要传递敏感数据】
URL<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>page1\?a<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span>b<span class="token operator">=</span><span class="token number">200</span>
服务器端接收参数
获取客户端请求GET请求提交的数据：

```python
request<span class="token punctuation">.</span>GET<span class="token punctuation">[</span><span class="token string">'参数名'</span><span class="token punctuation">]</span>
request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'参数名'</span><span class="token punctuation">,</span><span class="token string">'默认值'</span><span class="token punctuation">)</span>
request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'参数名'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果有传递多个值，则参数对应的应该是一个列表，需要使用getlist方法取出所有值，get方法只能取出最后一个值。<br><strong>应用场景：问卷调查的复选框</strong></p>
<p><strong>POST处理</strong><br>一般用于向服务器提交大量&#x2F;隐私数据<br>通过表单</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>form method <span class="token operator">=</span> <span class="token string">'post'</span> action <span class="token operator">=</span> <span class="token string">'/login'</span><span class="token operator">></span>
    姓名：<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">'text'</span> name <span class="token operator">=</span> <span class="token string">'username'</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">'submit'</span> value <span class="token operator">=</span> <span class="token string">'登录'</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="CSRF验证问题"><a href="#CSRF验证问题" class="headerlink" title="CSRF验证问题"></a>CSRF验证问题</h4><p>本身是django的防御措施，防御CSRF攻击问题，会阻止POST，暂时关闭：<br>settings.py》注释django.middleware.csrf.CsrfViewMiddleware</p>
<h3 id="Django的设计模式"><a href="#Django的设计模式" class="headerlink" title="Django的设计模式"></a>Django的设计模式</h3><p>传统的MVC Mode-View-Controller（模型-视图-控制器）模式。<br>特点：低耦合</p>
<ul>
<li>M模型层：主要用于对数据库层的封装</li>
<li>V视图层：用于给用户展示结果（WHAT + HOW显示什么，怎么显示）</li>
<li>C控制层：用于处理请求、获取数据、返回结果</li>
</ul>
<p>Django：MTV模式<br>把MVC的V拆成了两层，并且弱化C层为路由文件。</p>
<ul>
<li>M模型层：与MVC相同</li>
<li>T模板层：Template，专门负责html相关事情（HOW）</li>
<li>V视图层：核心，负责接收请求，获得结果，返回结果。<br>  在该模式下依然存在控制层C，即主路由</li>
</ul>
<h2 id="Django模板层"><a href="#Django模板层" class="headerlink" title="Django模板层"></a>Django模板层</h2><h3 id="模板层创建"><a href="#模板层创建" class="headerlink" title="模板层创建"></a>模板层创建</h3><p>模板：根据字典数据动态变化的html网页，根据视图中传递的字典数据动态生成相应的html页面<br>模板配置：</p>
<ul>
<li>创建模板文件夹 &lt;项目名&gt;&#x2F;templates</li>
<li>在settings.py中TEMPLATE配置项<ul>
<li>BACKEND：指定模板引擎</li>
<li>DIRS：模板的搜索目录（可以是一个或多个）</li>
<li>APP_DIRS：是否在应用中的templates文件夹中搜索末班文件</li>
<li>OPTIONS：有关模板的选项</li>
</ul>
</li>
<li>主要需要修改的：DIRS：<br>  ‘DIRS’:[os.path.join(BASE_DIR,’templates’)]</li>
</ul>
<p><strong>模板加载方案1：</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>template <span class="token keyword">import</span> loader
<span class="token number">1.</span>通过loader加载模板
t <span class="token operator">=</span> loader<span class="token punctuation">.</span>get_template<span class="token punctuation">(</span><span class="token string">"模板文件名"</span><span class="token punctuation">)</span>
<span class="token number">2.</span>将t转化为HTML字符串
html <span class="token operator">=</span> t<span class="token punctuation">.</span>render<span class="token punctuation">(</span>字典数据<span class="token punctuation">)</span>
<span class="token number">3.</span>用响应对象将转换的字符串内容返回给浏览器
<span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>模板加载方案2：</strong><br>使用render直接加载并且响应模板。<br>在视图函数中</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render
<span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'模板文件名'</span><span class="token punctuation">,</span>字典数据<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>视图层与模板层之间的交互</p>
<ul>
<li>视图函数中可以将Python变量封装到字典中传递到模板中。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">xxx_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        k1<span class="token punctuation">:</span> v1<span class="token punctuation">,</span>
        k2<span class="token punctuation">:</span> v2
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'xxx.html'</span><span class="token punctuation">,</span> dic<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>模板中使用的语法来调用视图传进来的变量。</li>
</ul>
<h3 id="模板的变量"><a href="#模板的变量" class="headerlink" title="模板的变量"></a>模板的变量</h3><p>能传递到模板中的变量类型：str,int,list,tuple,dict,func,obj</p>
<p>在模板中使用变量的语法：</p>
<ul>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
<h3 id="模板层的标签"><a href="#模板层的标签" class="headerlink" title="模板层的标签"></a>模板层的标签</h3><p>作用：将一些服务器端的功能嵌入到模板中，例如流程控制等</p>
<p>语法</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% 标签 %&#125;
…
&#123;% 结束标签 %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>例：<br>if标签</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% if 条件表达式 1 %&#125;
…
&#123;% elif 条件表达式 2 %&#125;
…
&#123;% elif 条件表达式 3 %&#125;
…
&#123;% else %&#125;
…
&#123;% endif %&#125;#！！一定记住要封口<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>NOTICE!在模板中使用实际括号是无效的语法，如果需要指示优先级，则应该选择嵌套if</p>
<p>for标签<br>语法</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% for 变量 in 可迭代对象 %&#125;
    …循环语句
&#123;% empty %&#125;
    …可迭代对象无数据时填充语句
&#123;% endfor %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>内置变量forloop<br>forloop.counter:循环的当前迭代（从1开始索引）<br>forloop.counter0:循环的当前迭代（从0开始索引）<br>forloop.revcounter:counter倒序<br>forloop.revcounter0:counter0倒序<br>forloop.first:第一次循环为真‘<br>forloop.last：最后一次循环为真<br>forloop.parentloop：外层循环</p>
<h3 id="模板层过滤器"><a href="#模板层过滤器" class="headerlink" title="模板层过滤器"></a>模板层过滤器</h3><p>过滤器：在变量输出时对变量的值进行处理<br>可以通过使用过滤器来改变变量的输出显示</p>
<p>语法：</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&#123;变量|过滤器1：&#39;参数1&#39;|过滤器2：&#39;参数值2&#39;…&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>常用过滤器：</p>
<ul>
<li>lower：转换为小写</li>
<li>upper：转换为大写</li>
<li>safe：魔人布对变量内的字符串进行html转义</li>
<li>add：将value的值增加n</li>
</ul>
<h3 id="模板的继承"><a href="#模板的继承" class="headerlink" title="模板的继承"></a>模板的继承</h3><p>模板继承使父模板内容重用，子模板直接继承父模板的全部内容并可以覆盖父模板中相应的块。</p>
<p>语法——父模板中：</p>
<ul>
<li>定义父模板中的块block标签</li>
<li>识别出哪些在子模板是允许被修改的</li>
<li>block标签：在父模板中定义，在子模板中覆盖</li>
</ul>
<p>语法——子模板中：</p>
<ul>
<li><p>继承模板extends标签（写在模板第一行）<br>  例如</p>
  <pre class="line-numbers language-none"><code class="language-none">&#123;%extend &#39;base.html&#39;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>子模板 复写父模板中的内容块</p>
  <pre class="line-numbers language-none"><code class="language-none">&#123;block block_name&#125;
&#123;% endblock blockname %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>重写的覆盖规则</p>
<ul>
<li>不重写，按照父模板的效果显示</li>
<li>重写，则按照重写效果显示<br>  注意：</li>
<li>模板继承时，服务器的动态内容无法继承</li>
</ul>
<h3 id="url反向解析"><a href="#url反向解析" class="headerlink" title="url反向解析"></a>url反向解析</h3><p>代码中url的位置：<br>1.模板</p>
<ul>
<li>超链接&lt;a href &#x3D; &gt;</li>
<li>form表单 form action 将表单中的数据用POST的方法提交到url</li>
</ul>
<p>2.视图函数中 - 302跳转 HttpResponseRedirect(‘url’)<br>将用户地址栏中的地址跳转到url</p>
<p>代码中的url书写规范</p>
<ul>
<li>1.绝对地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/page/">http://127.0.0.1:8000/page/</a></li>
<li>2.相对地址：<ul>
<li>a ‘&#x2F;page&#x2F;1&#x2F;‘浏览器会把当前地址栏的协议、IP和端口加上这个地址</li>
<li>b ‘page&#x2F;1&#x2F;‘没有&#x2F;开头的，浏览器会根据当前url最后一个&#x2F;之前的内容加上该相对地址作为最终访问地址</li>
</ul>
</li>
</ul>
<p>url反向解析<br>指在视图或模板中，用path定义的别名来动态查找或计算出相应的路由。<br>path：</p>
<ul>
<li>path(route,views,name&#x3D;’别名’)</li>
</ul>
<p>模板中：</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% url &#39;别名&#39;%&#125;
&#123;% url &#39;别名&#39; &#39;参数值1&#39; &#39;参数值2&#39;%&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>视图函数中<br>调用reverse方法进行方向解析</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
reverse<span class="token punctuation">(</span><span class="token string">'别名'</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ex:<br>print(reverse(‘pagen’,args&#x3D;[300]))<br>print(reverse(‘person’,kwargs&#x3D;{‘name’:’xixi’,’age’:18}))</p>
<h3 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h3><p>什么是静态文件：图片、css、js、音频、视频<br>静态文件属于静态请求，不经过视图函数<br>静态文件配置-settings.py</p>
<ul>
<li>1.静态文件的访问路径，默认’&#x2F;static&#x2F;‘</li>
<li>2.STATICFILES_DIRS，静态文件在服务器端的存储位置<br>  元组</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">STATICFILES_DIRS &#x3D; （
        os.path.join(BASE_DIR, &quot;static&quot;),
）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>3.方案2通过</p>
  <pre class="line-numbers language-none"><code class="language-none">&#123;% static %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  标签访问静态文件</p>
<ul>
<li><p>1.加载static-</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% load static %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
<li><p>2.使用静态资源-</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;% static&#39;静态资源路径&#39; %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
<li><p>3.样例：</p>
</li>
</ul>
  <pre class="line-numbers language-none"><code class="language-none">&lt;img src&#x3D;&quot;&#123;% static &#39;images&#x2F;lena.jpg&#39; %&#125;&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="应用创建"><a href="#应用创建" class="headerlink" title="应用创建"></a>应用创建</h3><p>每一个应用都是一个MTV<br>创建应用</p>
<ul>
<li>用manage.py执行startapp</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>python manage.py startapp music</p></blockquote>
<ul>
<li>在settings.py的INSTALLED_APPS列表中配置安装此应用</li>
</ul>
<p>执行创建应用后，应用文件夹下</p>
<ul>
<li>migrations文件夹：与DB有关</li>
<li><strong>init</strong>.py</li>
<li>admin.py</li>
<li>apps.py</li>
<li>models.py:与DB相关</li>
<li>tests.py</li>
<li>views.py：视图函数</li>
</ul>
<h3 id="分布式路由"><a href="#分布式路由" class="headerlink" title="分布式路由"></a>分布式路由</h3><p>Django中，主路由配置文件可以不处理用户具体路由，主路由配置文件的可以做请求的分发（分布式请求处理）。具体的请求可以由各自的应用来进行处理。<br>主路由匹配前缀，如&#x2F;news&#x2F;，再往下分发到子路由配置。<br>配置分布式路由：</p>
<ul>
<li>主路由中调用include函数</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;music&#x2F;index -&gt; path(&#39;music&#x2F;&#39;,include(&#39;music.urls&#39;))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>在子路由下创建urls.py，其内部结构与主路由完全一致。<br>  path(‘index&#x2F;‘, views.index_view)</li>
</ul>
<h3 id="应用下的模板"><a href="#应用下的模板" class="headerlink" title="应用下的模板"></a>应用下的模板</h3><p>应用内部可以配置模板目录</p>
<ul>
<li>1.应用下手动创建templates文件夹</li>
<li>2.settings.py中开启应用模板功能</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>TEMPLATE配置项中的’APP_DIRS’值为True即可、</p></blockquote>
<p><strong>important：查找模板的顺序：外层templates文件夹-&gt;注册顺序的app内部的templates文件夹</strong><br>解决方法：在应用层的templates下创建嵌套同名子目录，从而在views.py render中使得html获得不一样的路径</p>
<h2 id="模型层及ORM介绍"><a href="#模型层及ORM介绍" class="headerlink" title="模型层及ORM介绍"></a>模型层及ORM介绍</h2><p>模型层：负责与数据库之间进行通信<br>Django配置mysql</p>
<ul>
<li>创建数据库mysql</li>
<li>更改settings.py：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.mysql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mysite3'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'POST'</span><span class="token punctuation">:</span> <span class="token string">'3306'</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>什么是模型：</p>
<ul>
<li>模型是一个Python的类，它是由django.db.models.Model派生出的子类。</li>
<li>一个模型类代表数据库的一张数据表</li>
<li>模型类中每一个类属性都代表数据库中的一个字段</li>
<li>模型是数据交互的接口，是表示和操作数据库的方法和方式。</li>
</ul>
<h3 id="ORM框架"><a href="#ORM框架" class="headerlink" title="ORM框架"></a>ORM框架</h3><p>ORM（对象关系映射），是一种程序技术，能够使用类和对象对数据库进行操作，从而避免通过SQL语句操作数据库。</p>
<p>作用</p>
<ul>
<li>建立模型类和表之间的对应关系，允许我们通过面向对象的方式来操作数据库。</li>
<li>根据设计的模型类生成数据库中的表格。</li>
<li>通过简单的配置就能更换数据库引擎。</li>
</ul>
<p>优点：</p>
<ul>
<li>只需要面向对象编程，简化了向数据库编写代码的流程。</li>
<li>实现了数据模型与数据库的解耦，屏蔽了不同数据库操作上的差异。</li>
</ul>
<p>缺点：</p>
<ul>
<li>对于复杂业务，使用成本较高</li>
<li>根据对象的操作转换为SQL语句，根据查询结果转化为对象，在映射过程中有性能损失。</li>
</ul>
<p>映射图：<br>ORM———-&gt;DB<br>类———-&gt;数据表<br>对象——–&gt;数据行<br>属性——–&gt;字段</p>
<p>数据库迁移：<br>迁移是Django同步您对模型所做出的更改（添加字段，删除模型等）到您的数据库模式的方式。</p>
<ul>
<li>1.生成迁移文件：</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>python manage.py makemigrations<br>生成一个中间文件，并保存在migrations文件夹中</p></blockquote>
<ul>
<li>2.执行迁移脚本程序</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>python manage.py migrate<br>执行迁移程序实现迁移，将每个应用下的migrations目录中的中间文件同步回数据库。</p></blockquote>
<h3 id="模型类"><a href="#模型类" class="headerlink" title="模型类"></a>模型类</h3><p>模型类-创建</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">class</span> 模型类名<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    字段名 <span class="token operator">=</span> models<span class="token punctuation">.</span>字段类型（字段选项）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>表名实际为 APP名称+类名称小写</p>
<h3 id="模型类-字段类型："><a href="#模型类-字段类型：" class="headerlink" title="模型类-字段类型："></a>模型类-字段类型：</h3><ul>
<li><p>BooleanField<br>  数据库类型：tinyint(1)<br>  编程语言中将使用True或False来表示值<br>  在数据库中则使用0或1来表示具体的值</p>
</li>
<li><p>Char<br>  数据库类型：VarChar（Django不支持Char）<br>  注意：必须要指定max_length参数值</p>
</li>
<li><p>DataField()<br>  数据库类型：date<br>  作用：表示日期<br>  参数：<strong>三选一</strong><br>+ auto_now:每次保存对象时，自动设置该字段为当前时间（取值：True&#x2F;False）<br>+ auto_now_add:当兑现第一次被创建时自动设置当前时间（取值：True&#x2F;False）<br>+ default:设置当前时间</p>
</li>
<li><p>DataTimeField()<br>  数据库类型：datatime(6)通常用这个，比上面那个精确一些<br>  作用：表示日期和时间<br>  参数：同DataField</p>
</li>
<li><p>FloatField()<br>  数据库类型：double<br>  编程语言中和数据库中都使用小数表示值</p>
</li>
<li><p>DecimalField()<br>  数据库类型：decimal(x,y)<br>  编程语言中:使用小数表示该列的值<br>  在数据库中：使用小数<br>  参数（必须有）：max_digits;decimal_places</p>
</li>
<li><p>EmailField()<br>  数据库类型：varchar<br>  编程语言和数据库中均使用字符串，但Django含有正则检查。</p>
</li>
<li><p>IntegerField()<br>  数据库类型：Int<br>  编程语言和数据库中使用整数</p>
</li>
<li><p>ImageField()<br>  数据库类型：varchar(100)<br>  作用：在数据库中为了保存图片路径<br>  编程语言和数据库中使用字符串</p>
</li>
<li><p>TextField()<br>  数据库类型：longtext<br>  作用：表示不定长的字符数据</p>
</li>
</ul>
<h3 id="模型类-字段选项："><a href="#模型类-字段选项：" class="headerlink" title="模型类-字段选项："></a>模型类-字段选项：</h3><p>创建列的额外信息</p>
<ul>
<li>primary_key：设置为True，则为主键，此数据库表不会创建id字段</li>
<li>blank:设置为True，则字段可以为空，控制的是Admin后台的提交，和mysql的null不同</li>
<li>null：设置为True，则该列允许为空<br>  默认为False,需要一个default选项来设置默认值</li>
<li>default：设置该列的默认值</li>
<li>db_index：设置为True，表示为该列增加索引</li>
<li>unique: 唯一索引</li>
<li>db_column：指定列的名称，如果不指定的话则采用属性名作为列名。不给的话字段名就是列名。</li>
<li>verbose_name：设置此字段在admin界面上的显示名称，可以中文化admin界面</li>
</ul>
<p>好习惯：字段选项【添加或更改】均要执行</p>
<h3 id="模型类-Meta内部类"><a href="#模型类-Meta内部类" class="headerlink" title="模型类-Meta内部类"></a>模型类-Meta内部类</h3><p>使用Meta类来给**模型(其实就是表的属性)**赋予属性，Meta类下有很多内建的类属性，可对模型类做一些控制。<br>如改表名：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">class</span> 模型类名<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    字段名 <span class="token operator">=</span> models<span class="token punctuation">.</span>字段类型（字段选项）
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        db_table <span class="token operator">=</span> <span class="token string">'book'</span>
        <span class="token comment">#控制模型类在admin后台显示的名称</span>
        verbose_name <span class="token operator">=</span> <span class="token string">'单数名'</span>
        <span class="token comment">#指定复数形态</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">'复数名'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Django对于数据库操作是惰性的，尽量不对数据库进行积极的修改，如设置的default值将不参与表的字段生成，只会参与实际插值。</p>
<h3 id="ORM-创建数据"><a href="#ORM-创建数据" class="headerlink" title="ORM-创建数据"></a>ORM-创建数据</h3><p>增删改查<br>ORM CRUD核心：模型类.管理器对象</p>
<p>管理器对象<br>每一个models.Model的模型类，都会有一个objects对象被同样继承下来，这个对象叫做管理器对象。<br>数据库的增删改查可以通过管理器实现。</p>
<p>创建数据<br>方案1：</p>
<ul>
<li>MyModel.objects.create(属性1&#x3D;值1，属性2&#x3D;值2,…)</li>
</ul>
<p>成功：返回创建好的实体对象<br>失败：抛出异常</p>
<p>方案2：</p>
<ul>
<li>创建MyModel实例对象，并调用save()并保存</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">obj <span class="token operator">=</span> Mymodel<span class="token punctuation">(</span>属性 <span class="token operator">=</span> 值，属性 <span class="token operator">=</span> 值<span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>属性 <span class="token operator">=</span> 值
obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>需要使用Django Shell</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>python manage.py shell<br><strong>代码每次变化，都需要重启Django Shell</strong></p></blockquote>
<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><h3 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h3><p>通过管理器对象进行<br>通过MyModel.objects管理器方法调用查询方法<br>方法</p>
<ul>
<li>all()<br>  用法：MyModel.objects.all()<br>  等价于select * from table<br>  返回值：QuerySet容器对象，类数组对象，内部存放了MyModel实例<br>  如</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;QuerySet [&lt;Book: Python,20.00&gt;, &lt;Book: jango,50.00&gt;, &lt;Book: JQuery,40.00&gt;, &lt;Book: Linux,30.00&gt;, &lt;Book: HTML5,26.00&gt;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>可以在模型类中定义__str__方法，自定义QuerySet中的输出格式，则输出时能输出格式化字符串。</strong></p>
<p>Django 同样支持方法的串联，以下方法在返回QuerySet后均可使用方法串联，且最终都会按照SQL顺序对数据库进行操作。</p>
<p><strong>print(QuerySet.query)将取得实际的SQL语句。</strong></p>
<ul>
<li>values(‘字段1’,’字段2’)<br>  等价于select 列1，列2 from xxx<br>  返回：QuerySet，但内部存字典，每一个字典代表一个数据<br>  如：</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;QuerySet [&#123;&#39;title&#39;: &#39;HTML5&#39;&#125;, &#123;&#39;title&#39;: &#39;jango&#39;&#125;, &#123;&#39;title&#39;: &#39;JQuery&#39;&#125;, &#123;&#39;title&#39;: &#39;Linux&#39;&#125;, &#123;&#39;title&#39;: &#39;Python&#39;&#125;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>values_list(‘字段1’,’字段2’)<br>  基本同上，但返回元组，使用时需要使用索引</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;QuerySet [(&#39;HTML5&#39;,), (&#39;jango&#39;,), (&#39;JQuery&#39;,), (&#39;Linux&#39;,), (&#39;Python&#39;,)]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>order_by(‘-列’(降序),’列’)<br>  等价于 ORDER BY<br>  返回：QuerySet<br>  如：</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;QuerySet [&lt;Book: jango,50.00&gt;, &lt;Book: JQuery,40.00&gt;, &lt;Book: Linux,30.00&gt;, &lt;Book: HTML5,26.00&gt;, &lt;Book: Python,20.00&gt;]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>filter(条件)<br>  语法：MyModel.objects.filter(属性1&#x3D;值1，属性2&#x3D;值2)（,默认是AND查询）<br>  等价于 条件查询<br>  返回值：QuerySet，存放模型实例</p>
</li>
<li><p>exclude(条件)<br>  语法同上<br>  等价于 WHERE NOT<br>  作用：返回不包含此条件的全部数据集<br>  电商取非可以用该语句</p>
</li>
<li><p>get(条件)<br>  <strong>容易报错，一定要Try一下</strong><br>  语法：MyModel.objects.get（条件）<br>  作用：返回满足条件的唯一一条数据<br>  说明：<strong>该方法只能返回一条数据</strong>，直接获得Object<br>  查询结果多于一条则抛出异常；查询结果没有数据则抛出Model.DoesNotExist异常。</p>
</li>
</ul>
<h3 id="查询谓词"><a href="#查询谓词" class="headerlink" title="查询谓词"></a>查询谓词</h3><p>类属性 + ‘__’ + 谓词<br>定义：做更灵活的条件查询时需要使用查询谓词<br>说明：每一个查询谓词都是一个独立的查询功能</p>
<ul>
<li>__exact:等值匹配</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>Author.objects.filter(id_exact&#x3D;1) &lt;&#x3D;&gt; SELECT * FROM Author WHERE ID&#x3D;1</p></blockquote>
<ul>
<li>__contains:包含指定值</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>Author.objects.filter(name__contains&#x3D;’w’)<br>SELECT * FROM Author WHERE name Like ‘%w%’</p></blockquote>
<ul>
<li>__startwith:以xxx开始</li>
<li>__endwith:以xxx结束</li>
<li>__gt:大于指定值</li>
<li>__gte:大于等于</li>
<li>__lt:小于</li>
<li>__lte:小于等于</li>
<li>__in:指定范围内</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>Author.objects.filter(name__in&#x3D;[‘中国’，’美国’])</p></blockquote>
<ul>
<li>__range:查询数据是否在指定区间范围内</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>Author.objects.filter(age__range(35,50))<br>&lt;&#x3D;&#x3D;&gt; SELECT * FROM Author WHERE age BETWEEN 35 AND 50</p></blockquote>
<h3 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h3><p>1.针对单个数据的修改<br>查(get())-&gt;改：通过对象.属性的方式更改-&gt;保存：对象.save()<br>2.批量更新数据<br>直接调用QuerySet的update(属性&#x3D;值实现批量修改)<br>针对QuerySet来做更改</p>
<h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><p>1.单个数据删除</p>
<ul>
<li>查找对应的数据对象</li>
<li>调用该数据对象的delete()方法实现删除</li>
</ul>
<p>2.批量数据删除</p>
<ul>
<li>查找QuerySet</li>
<li>调用delete()方法实现删除</li>
</ul>
<p>3.伪删除操作<br>通过在表里添加一个布尔型字段（is_active），默认是True；执行删除时，将欲删除数据的is_active置为False。<br><strong>注意</strong>：使用伪删除时，确保显示数据的地方，均添加了is_active&#x3D;True的过滤查询。</p>
<h3 id="F对象"><a href="#F对象" class="headerlink" title="F对象"></a>F对象</h3><p>F对象(很适合用于点赞)<br>·········································<br>**F对象实际等价于语句：<br>UPDATE TABLE SET COLUMN&#x3D;TABLE.VALUE+10<br>使用单句的数据库查询语句，Mysql的InnoDB引擎使用行锁，因此F对象的本质是使用了数据库中的锁。 **<br>·········································</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>一个F对象代表数据库中某条记录的字段的信息(不直接取出来)</li>
<li>作用：通常对数据库字段值在不获取的情况下进行操作，用于类属性之间的比较<br>  F(‘列名’)<br>  <strong>对数据库字段值在不获取的情况下进行操作</strong>：<br>  例：需求：将Book表中所有的market_price全部自增10。</li>
</ul>
<p>该需求原本只能通过循环取出每一个数据后+10再写入实现。</p>
<p>Query的update方法必须结合F对象方法实现<br>使用F语句</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>market_price<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'market_price'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>用于类属性之间的比较</strong>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>market_price_gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Q对象"><a href="#Q对象" class="headerlink" title="Q对象"></a>Q对象</h3><p>用于进行逻辑或、逻辑非操作时使用</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>market_price_lt<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token operator">|</span>Q<span class="token punctuation">(</span>price_gt<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Q对象能够实现互相间的&amp;与,|或,<del>非,&amp;</del>与非等操作。</p>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><p>聚合查询是指对一个表中的一个字段的数据进行部分或全部进行统计查询。<br>分为整表聚合和分组聚合。</p>
<ul>
<li>整表聚合<br>  聚合函数需要导入</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>语法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">MyModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>结果变量名（别名）<span class="token operator">=</span>聚合函数<span class="token punctuation">(</span><span class="token string">'列'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回：字典</p>
<ul>
<li>分组聚合<br>  其实是为了实现Having语句<br>  通过计算查询结果中每一个对象所关联的对象集合，从而得出总计值，为查询集的每一项生成聚合</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">QuerySet<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>结果变量名（别名）<span class="token operator">=</span>聚合函数<span class="token punctuation">(</span><span class="token string">'列'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回：QuerySet</p>
<h3 id="原生数据库操作："><a href="#原生数据库操作：" class="headerlink" title="原生数据库操作："></a>原生数据库操作：</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">1.</span>只用来查询：MyoModel<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>raw<span class="token punctuation">(</span>sql语句，拼接参数<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>返回值：RawQuerySet集合对象，不支持方法串联，只支持基本的循环等。</p>
<p>SQL注入问题：<br>使用原生语句，使用拼接参数的方式进行查询能适当避免SQL注入问题。</p>
<p>2.完全跨过模型类操作数据库</p>
<ul>
<li>导入</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> connection<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>用创建cursor类的构造函数创建cursor(游标)对象，为保证在出现异常时能够释放cursor，通常用with来创建操作</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cur<span class="token punctuation">:</span>
    cur<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'执行SQL语句'</span><span class="token punctuation">,</span><span class="token string">'拼接参数'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="admin后台管理"><a href="#admin后台管理" class="headerlink" title="admin后台管理"></a>admin后台管理</h2><p>admin后台用于开发过程中调用和调试，django会搜集所有已注册的模型类，并为这些模型类提供数据管理界面。</p>
<h3 id="后台的创建："><a href="#后台的创建：" class="headerlink" title="后台的创建："></a>后台的创建：</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">python manage<span class="token punctuation">.</span>py createsuperuser<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="注册自定义模型类"><a href="#注册自定义模型类" class="headerlink" title="注册自定义模型类"></a>注册自定义模型类</h3><ul>
<li>在应用的admin.py导入注册要管理的models类</li>
<li>调用admin.site.register方法进行注册</li>
</ul>
<p>显示样式是按照models.py中__str__方法显示的。</p>
<h3 id="模型管理器类"><a href="#模型管理器类" class="headerlink" title="模型管理器类"></a>模型管理器类</h3><p>作用：为后台管理界面添加便于操作的新功能<br>继承于django.contrib.admin里的ModelAdmin类</p>
<ul>
<li>在应用的admin.py定义模型管理器类</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">XXXXManager</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ……<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>绑定注册模型管理器和模型类,使用调用admin.site.register方法的第二个参数</li>
</ul>
<p>类属性：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">XXXXManager</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#表头</span>
    list_display <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'title'</span><span class="token punctuation">,</span><span class="token string">'price'</span><span class="token punctuation">]</span>
    <span class="token comment">#控制list_display哪些字段超链接进修改页</span>
    list_display_links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
    <span class="token comment">#添加过滤器</span>
    list_filter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
    <span class="token comment">#添加搜索框（模糊查询）</span>
    search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
    <span class="token comment">#添加可在列表页可编辑的字段，与</span>
    <span class="token comment">#list_display_links字段是互斥的</span>
    list_editable <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="关系映射"><a href="#关系映射" class="headerlink" title="关系映射"></a>关系映射</h2><p>关系映射：一对一，一对多，多对多。</p>
<h3 id="一对一映射"><a href="#一对一映射" class="headerlink" title="一对一映射"></a>一对一映射</h3><p>创建一对一外键：<br>语法：OneToOneField(类名, on_delete&#x3D;xxx(级联删除：在存在键的前提下的删除规则))<br>on_delete:</p>
<ul>
<li>models.CASCADE：级联删除，只是模拟SQL约束ON DELETE CASCADE，不影响Mysql设置。</li>
<li>models.PROTECT:保护删除，等同于mysql默认的RESTRICT</li>
<li>SET_NULL:保留关联数据，设置为NULL</li>
<li>SET_DEFAULT:将外键设置为默认值。</li>
</ul>
<p>创建一对一数据<br>无外键的模型类，和之前相同<br>有外键的模型类：</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>wife &#x3D; Wife.objects.create(name&#x3D;’王夫人’,author &#x3D; author1(类属性名称绑实例))<br>wife &#x3D; Wife.objects.create(name&#x3D;’王夫人’,author_id &#x3D; 1(类属性字段绑值))</p></blockquote>
<p>一对一查询</p>
<ul>
<li>正向查询：从外键查对象</li>
<li>反向查询：从对象查外键<br>  调用反向属性查询到关联的一方</li>
</ul>
<h3 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h3><p>核心：正向属性(authors)和反向属性(book_set)<br>在多表上设置外键，关联一表。</p>
<p>创建一对多数据：<br>语法：Foreignkey(“一”的模型类, on_delete&#x3D;xxx(级联删除：在存在键的前提下的删除规则))</p>
<p>添加数据：<br>先添加“一”，再添加“多”。<br>无外键的模型类，和之前相同<br>有外键的模型类：<br>类似上面</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>wife &#x3D; Wife.objects.create(name&#x3D;’王夫人’,author &#x3D; author1(类属性名称绑实例))<br>wife &#x3D; Wife.objects.create(name&#x3D;’王夫人’,author_id &#x3D; 1(类属性字段绑值))</p></blockquote>
<p>查询数据：<br>正向查询（有显性属性的）：由book查出版社：book.publisher<br>反向查询(使用反向属性)：</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>books &#x3D; pub1.book_set.all()<br>或books &#x3D; Book.objects.filter(publisher&#x3D;pub1)</p></blockquote>
<h3 id="多对多映射"><a href="#多对多映射" class="headerlink" title="多对多映射"></a>多对多映射</h3><p>核心：正向属性(authors)和反向属性(book_set)<br>mysql中多对多需要用三张表实现<br>Django中无需手动创建第三张表，Django自动完成</p>
<p>创建字段语法：属性 &#x3D; models.ManyToManyField(MyModel)</p>
<p>创建数据：</p>
<ul>
<li>1.先创建Author，再关联book</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>author1 &#x3D; Author.objects.create(name&#x3D;’1’)<br>author2 &#x3D; Author.objects.create(name&#x3D;’2’)<br>book1 &#x3D; author1.book_set.create(title &#x3D; ‘1’)#创建<br>author2.book_set.add(book1)#绑定</p></blockquote>
<ul>
<li>2.先创建book,再关联author</li>
</ul>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>book &#x3D; Book.objects.create(title&#x3D;’p1’)<br>author3 &#x3D; book.authors.create(name&#x3D;”3”)<br>book.authors.add(author1)</p></blockquote>
<h2 id="Cookies和Session"><a href="#Cookies和Session" class="headerlink" title="Cookies和Session"></a>Cookies和Session</h2><h3 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h3><p>从打开浏览器访问一个网站，到关闭浏览器结束此次访问，称之为一次会话。<br>HTTP本身是无状态的，导致会话状态难以保持。</p>
<h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>保存在客户端浏览器上的存储空间<br>特点：</p>
<ul>
<li>cookies在浏览器是以键值对的形式进行存储的，键和值都是以ASCII码的形式存储的</li>
<li>存储的数据带有生命周期</li>
<li>cookies的数据是按照域隔离的，不同的域之间无法访问</li>
<li><strong>cookies的内部数据会在每次访问此网站时都会携带到服务器，如果cookies过大会影响访问速度。</strong></li>
</ul>
<p>存储<br>HttpResponse.set_cookie(key,value&#x3D;’’,max_age&#x3D;None,expires&#x3D;None)<br>-key:cookie的名字<br>-value：cookie的值<br>-max_age：存活相对时间，秒<br>-expires：具体过期时间<br>当不指定max_age和expires时，关闭浏览器时此数据失效。</p>
<p>删除&amp;获取<br>获取：request.COOKIES<br>删除：request.delete_cookie(key)</p>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><p>会话保持-登录流程<br>用户登录-&gt;账号密码传至后端，服务器数据库验证，正确则发放cookie-&gt;后续浏览器将自动把当前域下的cookie都发送至服务器。但浏览器存储不是十分安全，因此引入了session。</p>
<p>session技术实际将数据存在了服务器里，对于不同的浏览器有不同的存储空间，生成空间后，会将一个sessionID返还给浏览器，浏览器会将sessionID存储在Cookies，之后每次返还给服务器。</p>
<p>session是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据。</p>
<p>session初始配置：</p>
<ul>
<li>1.INSTALLED_APPS:django.contrib.sessions</li>
<li>2.MIDDLEWARE:<br>  ‘django.contrib.sessions.middleware.SessionMiddleware’</li>
</ul>
<p>session的使用：<br>session对象是一个类似于字典的SessionStore类型的对象。</p>
<ul>
<li>保存session的值到服务器：<br>  request.session[‘KEY’] &#x3D; VALUE</li>
<li>获取session的值<br>  value &#x3D; request.session[‘KEY’]<br>  value &#x3D; request.session.get(‘KEY’,默认值)</li>
<li>删除session<br>  del request.session[‘KEY’]</li>
</ul>
<p>干预session时间：settings.py里的SESSION_COOKIE_AGE指定cookies中的保存时间，默认两周<br>SESSION_EXPIRE_AT_BROWSER_CLOSE &#x3D; True,关闭浏览器自动清除session，默认False<br>SESSION的数据在Django中保存在数据库中，因此需要保证已经执行过了migrate</p>
<p>Django session的问题：</p>
<ul>
<li>1.django session的表是单表设计，且该表数据量不会自动清理，哪怕是已经过期。</li>
<li>2.可以每晚执行python manage.py clearsessions，会自动删除已经过期的session数据。</li>
</ul>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p><strong>定义</strong>：缓存是一类可以更快的读取数据的介质统称，也指其他可以加快数据读取的存储方式。一般用来存储临时数据，常用介质的是读取速度很快的内存。<br><strong>意义</strong>：视图渲染有一定成本，数据库的频繁查询过高；所以对于低频变动的页面可以考虑使用缓存技术，减少实际渲染次数；用户拿到响应的时间成本会更低。<br><strong>场景</strong>：1.博客列表页；2.电商商品详情页<br>场景特点：数据变动频率较少</p>
<h3 id="Django中设置缓存：-settings-py"><a href="#Django中设置缓存：-settings-py" class="headerlink" title="Django中设置缓存：(settings.py)"></a>Django中设置缓存：(settings.py)</h3><ul>
<li>数据库缓存：将缓存存储在数据库中，尽管存储介质还是数据库，但把一次复杂查询的结果直接存储在表里，可避免重复进行复杂查询，提升效率。</li>
</ul>
<p>配置方法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">CACHES<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span><span class="token string">'django.core.cache.backends.db.DatabaseCache'</span><span class="token punctuation">,</span><span class="token comment">#引擎</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span><span class="token string">'my_cache_table'</span><span class="token punctuation">,</span><span class="token comment">#指定用于缓存的表</span>
        <span class="token string">'TIMEOUT'</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token comment">#缓存时间</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>
            <span class="token string">'MAX_ENTRIES'</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token comment">#最大存储条数</span>
            <span class="token string">'CULL_FREQUENCY'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">#缓存条数达到最大值时，删除1/x的数据</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>缓存到服务器内存中<br>  配置方法：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">CACHES<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    default<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span><span class="token string">'django.core.cache.backends.locmem.LocMemCache'</span><span class="token punctuation">,</span><span class="token comment">#引擎</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span><span class="token string">'unique-snowflake'</span><span class="token punctuation">,</span><span class="token comment">#雪花算法内存寻址</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>将缓存数据存储到本地文件中<br>  配置方法：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">CACHES<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    default<span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span><span class="token string">'django.core.cache.backends.filebased.FileBasedCache'</span><span class="token punctuation">,</span><span class="token comment">#引擎</span>
        <span class="token string">'LOCATION'</span><span class="token punctuation">:</span><span class="token string">'/var/tmp/django_cache'</span><span class="token punctuation">,</span><span class="token comment">#存储路径</span>
        <span class="token comment"># win'c:\test\cache'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="整体缓存策略"><a href="#整体缓存策略" class="headerlink" title="整体缓存策略"></a>整体缓存策略</h3><ul>
<li>视图函数中<br>  django还是使用了装饰器来实现缓存逻辑</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page
<span class="token decorator annotation punctuation">@cache_page</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token comment"># 单位秒</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>路由中<br>  一个道理，在进入视图函数前首先使用装饰器。换个地方写而已。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache_page
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'foo/'</span><span class="token punctuation">,</span>cache_page<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">(</span>my_view<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用简单粗暴，但是无法控制。</p>
<h3 id="局部缓存策略"><a href="#局部缓存策略" class="headerlink" title="局部缓存策略"></a>局部缓存策略</h3><p>相较于整体缓存更加灵活，复用性更好。<br>缓存api的使用：</p>
<ul>
<li>方式1：使用caches[‘CACHE配置key’]导入具体对象</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>caches <span class="token keyword">import</span> caches
cache1 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'myalias'</span><span class="token punctuation">]</span>
cache2 <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'myalias_2'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>方式2</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">直接调用CACHE中的default值。相当于<span class="token number">1</span>中的
cache <span class="token operator">=</span> caches<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>caches <span class="token keyword">import</span> cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>缓存api：</p>
<ul>
<li>1.cache.set(key,value,timeout)-存储缓存<br>  key:缓存的key，字符串类型<br>  value:python对象<br>  timeout：缓存存储时间，默认为CACHES中的TIMEOUT值<br>  返回值：None</li>
<li>2.cacahe.get(key)-获取缓存<br>  key：缓存的key<br>  返回值，key的对应值，没有则返回None</li>
<li>3.cache.add(key,value)-存储缓存，只在key不存在的时候生效<br>  返回值：True或False</li>
<li>4.cache.get_or_set(key,value,timeout)</li>
<li>5.cache.set_many(dict,timeout)</li>
<li>6.cache.get_many(key_list)</li>
<li>7.cache.delete(key)</li>
<li>8.cache.delete_many(key_list)</li>
</ul>
<h3 id="浏览器缓存策略-强缓存"><a href="#浏览器缓存策略-强缓存" class="headerlink" title="浏览器缓存策略-强缓存"></a>浏览器缓存策略-强缓存</h3><p>不会向服务器发送请求，直接从缓存中读取资源</p>
<ul>
<li>1.响应头-Expires：定义缓存过期时间，是服务器端的具体的时间点<br>  样例：Expires:Thu,02 Apr 2030 05:14:08 GMT</li>
<li>2.响应头-Cache-Control<br>  ‘Cache-Control:max-age&#x3D;120’120秒后缓存失效<br>  说明：目前服务器都会带着这两个头同时响应给浏览器，浏览器优先使用Cache-Control<br>  cache-page整体缓存自带强缓存功能</li>
</ul>
<h3 id="浏览器缓存策略-协商缓存"><a href="#浏览器缓存策略-协商缓存" class="headerlink" title="浏览器缓存策略-协商缓存"></a>浏览器缓存策略-协商缓存</h3><p>强缓存的对象是一些静态文件、大图片等，考虑到这类资源比较费带宽且不易变化，强缓存到期后，浏览器会根服务器进行协商，当前缓存是否可用，如果可用，服务器不必返回数据，浏览器继续使用原来缓存的数据，如果文件不可用，则返回最新数据。</p>
<ul>
<li>1.Last-Modified响应头：文件的最近修改时间，同时告诉服务器到期后协商</li>
<li>2.If-Modified-Since请求头，浏览器向服务器请求协商，如果资源未发生变化，则返回304（响应体为空），否则返回200代表缓存不可用（响应体为最新资源）</li>
</ul>
<p>上述的两个头仅通过精确到秒的时间来判断缓存是否有效，不是特别精准，后来HTTP又引入了新的缓存头：</p>
<ul>
<li>3.Etag响应头：返回当前资源的唯一标识（由服务器生成），只要资源变化，Etag就会重新生成</li>
<li>4.缓存到期，浏览器返回If-None-Match请求头，给服务器请求协商，服务器比对文件标识，不一致则认为资源不可用。</li>
</ul>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><ul>
<li>中间件是请求&#x2F;响应的钩子框架，用于全局改变Django的输入和输出。</li>
<li>中间件以类的形式体现</li>
<li>每个中间件负责一些特定的功能</li>
</ul>
<h3 id="中间件方法"><a href="#中间件方法" class="headerlink" title="中间件方法"></a>中间件方法</h3><p>继承django.utils.deprecation.MiddlewareMixin类<br>中间件类须实现下列五个方法中的一个或多个：</p>
<ul>
<li>process_request(self,request)<br>  执行路由之前被调用，在每个请求上调用，只能返回None或HttpResponse对象，None则通过。</li>
<li>process_view(self,request,callback,callback_args,callback_kwargs)<br>  在视图之前调用，在每个请求上调用，返回None或HttpResponse对象。</li>
<li>process_response(self,request,response)<br>  在响应返回浏览器被调用，在每个请求调用，返回HttpResponse对象。</li>
<li>process_exception(self,request,exception)<br>  当处理过程中抛出异常时调用，返回一个HttpResponse对象。用来统一抓所有视图函数的异常。</li>
<li>process_template_response(self,request,response)<br>  在响应中包含render方法时被调用，该方法返回二次封装后的render响应对象。</li>
</ul>
<p>中间件中的大部分方法返回None则表示进入下一项时间，返回HttpResponse则被拦截。</p>
<h3 id="编写中间件"><a href="#编写中间件" class="headerlink" title="编写中间件"></a>编写中间件</h3><ul>
<li>1.注册中间件settngs.py-MIDDLEWARE</li>
<li>2.建立中间件包，编写中间件’</li>
</ul>
<p>中间件的执行顺序<br>先由上到下，在进入视图后变为由下至上<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/ImageHosting/video/20210805152039.jpeg" alt="Django工作流程图片"></p>
<h2 id="CSRF-跨站伪造请求攻击"><a href="#CSRF-跨站伪造请求攻击" class="headerlink" title="CSRF - 跨站伪造请求攻击"></a>CSRF - 跨站伪造请求攻击</h2><p>利用Cookies自动提交功能，同时利用了form表单及一些html控件的跨域提交。</p>
<p>django的防御机制：页面和COOKIE都有一个暗号，只有两个暗号同时发送到服务器并且能够匹配，才允许POST。<br>配置步骤：</p>
<ul>
<li><p>保证django.middleware.csrf.CsrfViewMiddleware打开</p>
</li>
<li><p>模板中，form标签下添加如下标签：</p>
  <pre class="line-numbers language-none"><code class="language-none">&#123;% csrf_token %&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>当个别视图不需要django进行csrf保护可以用装饰器关闭对此视图的检查</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt

<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">my_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> …<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p>分页指在web页面有大量数据需要显示，为了阅读方便在每个页中只显示部分数据。</p>
<p>优点：</p>
<ul>
<li><ol>
<li>方便阅读</li>
</ol>
</li>
<li><ol start="2">
<li>减少数据提取量，减轻服务器压力。</li>
</ol>
</li>
</ul>
<p>Django提供了Paginator类可以方便的实现分页功能<br>Paginator类位于’django.core.paginator’模块中</p>
<h3 id="paginator对象"><a href="#paginator对象" class="headerlink" title="paginator对象"></a>paginator对象</h3><p>负责分页数据整体的管理</p>
<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot="">
<path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path>
<path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path>
<path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path>
<path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path>
</svg>
</span><p>pagenator &#x3D; Paginator(object_list,per_page)</p></blockquote>
<ul>
<li>object_list 需要分页数据的对象列表，如QuerySet</li>
<li>per_page 分页数据个数</li>
<li>返回值：Paginator对象</li>
</ul>
<p>Paginator对象属性</p>
<ul>
<li>count：需要分页的数据对象总数</li>
<li>num_pages:分页后的页面总数</li>
<li>page_range：从1开始的range对象，用于记录当前页码数</li>
<li>per_page：每页数据个数</li>
</ul>
<p>Paginator方法<br>paginator对象.page(number)<br>    -参数number为页码信息(从1开始)<br>    -返回当前number页对应的页信息<br>    -如果提供的页码不存在，抛出InvalidPage异常，包含两种异常子类-PageNotInteger页码不是整数和-EmptyPage页码超页</p>
<h3 id="page对象"><a href="#page对象" class="headerlink" title="page对象"></a>page对象</h3><p>Paginator对象的page()方法返回Page对象<br>page &#x3D; paginator.page(页码)</p>
<p>page对象属性：</p>
<ul>
<li>object_list：当前页上所有数据对象的列表</li>
<li>number:当前页面的序号，从1开始</li>
<li>paginator：当前page对象相关的Paginator对象</li>
</ul>
<p>Page对象方法： </p>
<ul>
<li>has_next():如果有下一页返回True</li>
<li>next_page_number():下一页页码，如果下一页不存在，抛出InvalidPage异常</li>
<li>has_previous:如果有上一页返回True</li>
<li>previous_page_number():返回上一页的页码，如果上一页不存在，抛出InvalidPage异常。</li>
<li>has_other_pages：如果有上一页或者有下一页返回True</li>
</ul>
<h2 id="csv文件"><a href="#csv文件" class="headerlink" title="csv文件"></a>csv文件</h2><ul>
<li>csv文件：逗号分隔值文件，其文件以纯文本形式存储表格数据（数字或文本）<br>  说明：可被常见制表工具，如excel等直接进行读取</li>
</ul>
<h3 id="python中生成csv文件"><a href="#python中生成csv文件" class="headerlink" title="python中生成csv文件"></a>python中生成csv文件</h3><p>python提供了内建库 -csv；可直接通过该库操作csv文件。<br>案例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'eggs.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">as</span> csvfile<span class="token punctuation">:</span><span class="token comment"># newline指文件输出时换行符怎么处理，空字符串将不会转义</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="csv文件下载"><a href="#csv文件下载" class="headerlink" title="csv文件下载"></a>csv文件下载</h3><p>在网站中实现下载csv，注意如下：</p>
<ul>
<li>响应Content-Type类型需修改为text&#x2F;csv。这告诉浏览器该文档是CSV文件，而不是HTML文件</li>
<li>响应为额外添加一个Content-Disposition标头，其中包含CSV文件的名称，它将被浏览器用于开启”另存为”对话框。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> csv
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Book

<span class="token keyword">def</span> <span class="token function">make_csv_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span>content_type <span class="token operator">=</span> <span class="token string">'text/csv'</span><span class="token punctuation">)</span>
    response<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment;filename = "mybook.csv"'</span>
    all_book <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> all_book<span class="token punctuation">:</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>b<span class="token punctuation">.</span>title<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="内建用户系统"><a href="#内建用户系统" class="headerlink" title="内建用户系统"></a>内建用户系统</h2><p>模型类位置<br>from django.contrib.auth.models import User<br>（mysql中auth_user表）<br>字段（属性）：</p>
<ul>
<li>username 用户名</li>
<li>password 密码</li>
<li>email 邮箱</li>
<li>first_name 名</li>
<li>last_name 姓</li>
<li>is_superuser 是否为超级用户</li>
<li>is_staff 是否为内部员工</li>
<li>is_active 伪删除</li>
<li>last_login 上次登陆时间</li>
<li>date_joined 用户创建时间</li>
</ul>
<p>命令：</p>
<ul>
<li>1.创建普通用户create_user,主要是需要处理密码，将自动转化密码为hash值。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"用户名"</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">"密码"</span><span class="token punctuation">,</span>email<span class="token operator">=</span><span class="token string">"邮箱"</span><span class="token punctuation">,</span>…<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><p>2.创建超级用户create_superuser</p>
</li>
<li><p>3.删除用户(伪删除，更新操作)</p>
</li>
<li><p>4.校验密码</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> authenticate

user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如果用户名密码校验成功则返回用户对象，否则返回None</p>
<ul>
<li><p>5.修改密码set_password</p>
</li>
<li><p>6.登录状态保持<br>  只存session，且时间不可控</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> login
<span class="token keyword">def</span> <span class="token function">login_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>：
    user <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span>
    login<span class="token punctuation">(</span>request<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>7.登录状态校验</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">index_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    login_user <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token comment">#直接能拿到usert对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>8.登录状态取消</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout
<span class="token keyword">def</span> <span class="token function">logout_view</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>内建用户表-扩展字段</strong><br>方案1:通过建立细腻哦啊，和内建表做1对1映射<br>方案2：继承抽象user模型类<br>方案2步骤：</p>
<ul>
<li>1.添加应用</li>
<li>2.定义模型类，继承AbastractUser</li>
<li>3.settings.py中指明AUTH USER MODEL &#x3D; ‘应用名.类名’</li>
</ul>
<p><strong>！！注意：此操作需要在第一次migrate之前进行！！</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser

<span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>Abstractuser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在settings.py里面添加配置：<br>AUTH_USER_MODEL &#x3D; ‘user.UserInfo’</p>
<p>添加用户<br>from user.models import UserInfo</p>
<p>UserInfo.objects.create_user(username&#x3D;……,phone&#x3D;’’)</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>定义：用户可以通过浏览器将图片等文件传至网站<br>场景：</p>
<ul>
<li>上传头像</li>
<li>上传流程性的文件</li>
</ul>
<h3 id="上传规范-前端"><a href="#上传规范-前端" class="headerlink" title="上传规范-前端"></a>上传规范-前端</h3><p>上传必须为POST提交方式<br>表单’&lt;\form&gt;’中文件上传时必须有带有enctype&#x3D;’multipart&#x2F;form-data’时才会包含文件内容数据。<br>表单中用&lt;input type &#x3D; ‘files’ name&#x3D;’xxx’&gt;标签上传文件</p>
<h3 id="上传规范-后端"><a href="#上传规范-后端" class="headerlink" title="上传规范-后端"></a>上传规范-后端</h3><p>视图函数中，需要用request.FILES取文件框的内容<br>file&#x3D;request.FILES[‘xxx’]<br>说明：</p>
<ul>
<li>1.FILES的key对应页面中file框的name值</li>
<li>2.file绑定文件流对象</li>
<li>3.file.name文件名</li>
<li>4.file.file文件的字节流数据</li>
</ul>
<p>配置文件的访问路径和存储路径<br>在settings.py中设置MEDIA相关配置，Django将用户上传的文件统称为media资源</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">MEDIA_URL<span class="token operator">=</span><span class="token string">'/media/'</span>
MEDIA_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'media'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>同时MEDIA_URL和MEDIA_ROOT还需要手动绑定：在主路由添加：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>static <span class="token keyword">import</span> static
urlpatterns <span class="token operator">+=</span> static<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_URL<span class="token punctuation">,</span>document_root<span class="token operator">=</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>等价于做了MEDIA_URL开头的路由，Django接到该特征请求后去MEDIA_ROOT路径查找资源</p>
<p>文件写入：</p>
<ul>
<li>1.open方法<br>  可能出现文件名称的重名问题</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 在视图函数POST中</span>
a_file <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">[</span><span class="token string">'myfile'</span><span class="token punctuation">]</span>
fileadd <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>MEDIA_ROOT<span class="token punctuation">,</span>afile<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    data <span class="token operator">=</span> afile<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">return</span> HttpResponse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>2.借助ORM<br>  字段FileField(upload &#x3D; ‘子目录名’)<br>  建表时增加一个字段即可，实际收到后直接在视图函数中将绑定文件流对象扔给对应字段即可</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Content<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>desc <span class="token operator">=</span> title<span class="token punctuation">,</span> content <span class="token operator">=</span> a_file<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该方法若文件名重复则django将自动添加后缀</p>
<h2 id="django发送邮件"><a href="#django发送邮件" class="headerlink" title="django发送邮件"></a>django发送邮件</h2><p>业务场景：</p>
<ul>
<li>业务报警</li>
<li>邮件验证</li>
<li>密码找回</li>
</ul>
<h3 id="邮件相关协议"><a href="#邮件相关协议" class="headerlink" title="邮件相关协议"></a>邮件相关协议</h3><ul>
<li><p>SMTP：Simple Mail Transfer Protocol，简单邮件传输协议（port：25）<br>  负责邮件的发送，属于“推送”协议</p>
</li>
<li><p>IMAP：Internet Mail Access Protocol，交互式邮件访问协议，应用层协议（port：143）<br>  负责本地邮件客户端访问远程服务器上的邮件，属于“拉取”协议</p>
</li>
<li><p>POP3：Post Office Protocol3：邮局协议第3个版本，是TCP&#x2F;IP协议族中的一员（port：110）<br>  本协议主要用于支持使用客户端远程管理在服务器上的电子邮件，同样属于“拉取”协议。</p>
</li>
</ul>
<p><strong>IMAP VS POP3:</strong></p>
<ul>
<li>两者均为“拉取”协议，负责从邮件服务器中下载邮件</li>
<li>IMAP支持摘要浏览功能，并且是双向协议，客户端操作可以反馈给服务器</li>
<li>POP3必须下载全部邮件，且为单向协议，客户端操作无法同步服务器。</li>
</ul>
<h3 id="Django发邮件"><a href="#Django发邮件" class="headerlink" title="Django发邮件"></a>Django发邮件</h3><p>Django中配置邮件功能，主要为SMTP协议，负责发邮件<br>原理：</p>
<ul>
<li>给Django授权一个邮箱</li>
<li>Django用该邮箱给对应收件人发送邮件</li>
<li>django.core.mail封装了电子邮件的自动发送SMTP协议</li>
</ul>
<p>授权：</p>
<ul>
<li>邮箱端修改<br>  开启SMTP相关的功能，获得授权码。</li>
<li>Django修改(settings.py添加)</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">'django.core.mail.backends.smtp.EmailBackend'</span><span class="token comment"># 引擎：写死</span>
EMAIL_HOST <span class="token operator">=</span> <span class="token string">'smtp.qq.com'</span><span class="token comment"># 腾讯qq邮箱的SMTP服务器地址</span>
EMAIL_PORT <span class="token operator">=</span> <span class="token number">25</span><span class="token comment"># 默认25</span>
EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">'xxxx@qq.com'</span>
EMAIL_HOST_PASSWORD <span class="token operator">=</span> <span class="token string">'*******'</span><span class="token comment"># 指的是授权码</span>
EMAIL_USE_TLS <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment"># 与SMTP服务器通讯时，是否启动TLS连接（安全链接）默认为False，安全协议比较耗时</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发送：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core <span class="token keyword">import</span> mail
mail<span class="token punctuation">.</span>send_mail<span class="token punctuation">(</span>
    subject<span class="token punctuation">,</span>
    message<span class="token punctuation">,</span>
    from_email<span class="token punctuation">,</span><span class="token comment"># 发送邮箱</span>
    recipient_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'xxx@qq.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment"># 接受者邮箱列表</span>
<span class="token punctuation">)</span>
返回<span class="token number">1</span>则成功发送<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过中间件可以捕获所有视图函数的异常，并发送到指定邮箱<br>process_exception(self,request,exception)<br>定位错误位置：异常追溯</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> traceback
traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 直接获得错误具体位置及出错信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>邮箱里可以直接发送traceback.format_exc()</p>
<p>自定义收件人：<br>在settings里自定义属性，在调用send_mail位置</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings
recipient_list <span class="token operator">=</span> settings<span class="token punctuation">.</span>自定义属性<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><p>在软件开发完毕后，将开发机器上运行的软件实际安装到服务器上进行长期运行</p>
<ol>
<li>安装机器上安装和配置同版本的环境[py,数据库等]</li>
<li>django项目迁移，第三方工具：finalshare等<br> ubuntu直接用scp命令<br> sudo scp 需要复制文件路径 远程ip:路径</li>
<li>用uWSGI替代python manage.py runserver方法</li>
<li>配置nginx反向代理服务器</li>
<li>用nginx配置静态文件路径，解决静态路径问题</li>
</ol>
<h3 id="uWSGI"><a href="#uWSGI" class="headerlink" title="uWSGI"></a>uWSGI</h3><p>WSGI：Web Server Gateway Interface，Web服务器网关接口，是Pyhton应用程序或框架和Web服务器之间的一种接口。<br>uWSGI：WSGI的一种，实现了http协议、WSGI协议、uwsgi协议等多种协议。在python web圈热度极高，主要以学习配置为主。</p>
<p>uWSGI安装<br>pip命令可以安装<br>[ubuntu验证安装]:sudo pip3 freeze|grep -i ‘uwsgi’<br>[ubuntu安装]:sudo pip3 install uwsgi&#x3D;&#x3D;2.0.18 -i <a target="_blank" rel="noopener" href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a></p>
<p>配置uWSGI:</p>
<ul>
<li>项目同名文件夹&#x2F;uwsgi.ini</li>
</ul>
<p>如mysite1&#x2F;mysite1&#x2F;uwsgi.ini<br>文件以[uwsgi]开头，有如下配置项：</p>
<ul>
<li>1监听端口<br>  套接字方式的IP地址：端口号[此模式需要有nginx]<br>  socket&#x3D;127.0.0.1:8000<br>  Http通信凡是的IP地址：端口号<br>  http&#x3D;127.0.0.1:8000</li>
<li>2项目当前工作目录<br>  chdir&#x3D;<strong>绝对路径</strong></li>
<li>3项目中wsgi.py文件目录，相对于当前工作目录<br>  wsgi-file&#x3D;<strong>相对路径</strong></li>
<li>4进程个数(最多为cpu核数)<br>  process&#x3D;4</li>
<li>5每个进程的线程个数<br>  threads&#x3D;2</li>
<li>6服务的pid记录文件<br>  pidfile&#x3D;uwsgi.pid</li>
<li>7服务的日志文件位置(后台启动以及所有日志位置)<br>  daemonize&#x3D;uwsgi.log</li>
<li>8开启主进程管理模式<br>  master&#x3D;true</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforteachingdemo/20201127203438.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforteachingdemo/20201127203438.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">kif</div><div class="post-copyright__author_desc">梅虽逊雪三分白，雪却输梅一段香</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://wkif.gitee.io/post/9108.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://wkif.gitee.io/post/9108.html')">后端框架学习-Django</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://wkif.gitee.io/post/9108.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=后端框架学习-Django&amp;url=https://wkif.gitee.io/post/9108.html&amp;pic=https://kifimg.oss-cn-beijing.aliyuncs.com/imgforhexo/882690e66cdd6486c7ced449245fe620.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wkif.gitee.io" target="_blank">Kifroom</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Django/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Django<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/Python/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Python<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforteachingdemo/20201127203438.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/dc7f.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/wkif/imgforTeachingDemo/202203310008758.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">微信小程序云开发实现图片的上传、存储、访问</div></div></a></div><div class="next-post pull-right"><a href="/post/9a9f.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforhexo/202203310005647.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计算机网络--重传时间计算</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/imgforteachingdemo/20201127203438.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">kif</h1><div class="author-info__desc">梅虽逊雪三分白，雪却输梅一段香</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/wkif" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVC-%E4%B8%8E-MTV%E6%A8%A1%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">MVC 与 MTV模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC-%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">MVC 模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MTV-%E6%A8%A1%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">MTV 模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number"></span> <span class="toc-text">创建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">使用命令行创建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE-1"><span class="toc-number">1.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%8C%E5%89%8D%E5%8F%B0%E5%90%AF%E5%8A%A8%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">启动服务（测试用，前台启动）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">关闭服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">启动应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.</span> <span class="toc-text">列出所有的命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.</span> <span class="toc-text">生成数据库迁移文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="toc-number">1.7.</span> <span class="toc-text">执行数据库迁移</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5-Django-Shell"><span class="toc-number">1.8.</span> <span class="toc-text">进入 Django Shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAadmin"><span class="toc-number">1.9.</span> <span class="toc-text">创建admin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E5%B7%B2%E8%BF%87%E6%9C%9FSessions"><span class="toc-number">1.10.</span> <span class="toc-text">清理已过期Sessions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90requirements-txt%EF%BC%9B"><span class="toc-number">2.</span> <span class="toc-text">生成requirements.txt；</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E5%AD%98%E8%A1%A8"><span class="toc-number">2.1.</span> <span class="toc-text">创建内存表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#settings-py"><span class="toc-number">3.</span> <span class="toc-text">settings.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL"><span class="toc-number">4.</span> <span class="toc-text">URL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number"></span> <span class="toc-text">视图函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">路由配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">HTTP请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82-x2F-%E5%93%8D%E5%BA%94"><span class="toc-number"></span> <span class="toc-text">请求&#x2F;响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E8%AF%B7%E6%B1%82%E5%92%8CPOST%E8%AF%B7%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">GET请求和POST请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF%E9%AA%8C%E8%AF%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">CSRF验证问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">Django的设计模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django%E6%A8%A1%E6%9D%BF%E5%B1%82"><span class="toc-number"></span> <span class="toc-text">Django模板层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%B1%82%E5%88%9B%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">模板层创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">2.</span> <span class="toc-text">模板的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%B1%82%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="toc-number">3.</span> <span class="toc-text">模板层的标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%B1%82%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">模板层过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-number">5.</span> <span class="toc-text">模板的继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">url反向解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">静态文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%88%9B%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">应用创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%B7%AF%E7%94%B1"><span class="toc-number">2.</span> <span class="toc-text">分布式路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E4%B8%8B%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.</span> <span class="toc-text">应用下的模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%B1%82%E5%8F%8AORM%E4%BB%8B%E7%BB%8D"><span class="toc-number"></span> <span class="toc-text">模型层及ORM介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ORM%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">ORM框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">模型类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">模型类-字段类型：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB-%E5%AD%97%E6%AE%B5%E9%80%89%E9%A1%B9%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">模型类-字段选项：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB-Meta%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text">模型类-Meta内部类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ORM-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">6.</span> <span class="toc-text">ORM-创建数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM"><span class="toc-number"></span> <span class="toc-text">ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">查询操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%B0%93%E8%AF%8D"><span class="toc-number">2.</span> <span class="toc-text">查询谓词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">更新操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">删除操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.</span> <span class="toc-text">F对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Q%E5%AF%B9%E8%B1%A1"><span class="toc-number">6.</span> <span class="toc-text">Q对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.</span> <span class="toc-text">聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%EF%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">原生数据库操作：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#admin%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86"><span class="toc-number"></span> <span class="toc-text">admin后台管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%9A%84%E5%88%9B%E5%BB%BA%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">后台的创建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">注册自定义模型类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%AE%A1%E7%90%86%E5%99%A8%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">模型管理器类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84"><span class="toc-number"></span> <span class="toc-text">关系映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80%E6%98%A0%E5%B0%84"><span class="toc-number">1.</span> <span class="toc-text">一对一映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.</span> <span class="toc-text">一对多查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84"><span class="toc-number">3.</span> <span class="toc-text">多对多映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookies%E5%92%8CSession"><span class="toc-number"></span> <span class="toc-text">Cookies和Session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.</span> <span class="toc-text">会话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookies"><span class="toc-number">2.</span> <span class="toc-text">Cookies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session"><span class="toc-number">3.</span> <span class="toc-text">session</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number"></span> <span class="toc-text">缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Django%E4%B8%AD%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98%EF%BC%9A-settings-py"><span class="toc-number">1.</span> <span class="toc-text">Django中设置缓存：(settings.py)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">2.</span> <span class="toc-text">整体缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">3.</span> <span class="toc-text">局部缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5-%E5%BC%BA%E7%BC%93%E5%AD%98"><span class="toc-number">4.</span> <span class="toc-text">浏览器缓存策略-强缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5-%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98"><span class="toc-number">5.</span> <span class="toc-text">浏览器缓存策略-协商缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number"></span> <span class="toc-text">中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">中间件方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">编写中间件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF-%E8%B7%A8%E7%AB%99%E4%BC%AA%E9%80%A0%E8%AF%B7%E6%B1%82%E6%94%BB%E5%87%BB"><span class="toc-number"></span> <span class="toc-text">CSRF - 跨站伪造请求攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5"><span class="toc-number"></span> <span class="toc-text">分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#paginator%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">paginator对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#page%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.</span> <span class="toc-text">page对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csv%E6%96%87%E4%BB%B6"><span class="toc-number"></span> <span class="toc-text">csv文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E4%B8%AD%E7%94%9F%E6%88%90csv%E6%96%87%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">python中生成csv文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#csv%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.</span> <span class="toc-text">csv文件下载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%BB%BA%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F"><span class="toc-number"></span> <span class="toc-text">内建用户系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number"></span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E8%A7%84%E8%8C%83-%E5%89%8D%E7%AB%AF"><span class="toc-number">1.</span> <span class="toc-text">上传规范-前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E8%A7%84%E8%8C%83-%E5%90%8E%E7%AB%AF"><span class="toc-number">2.</span> <span class="toc-text">上传规范-后端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6"><span class="toc-number"></span> <span class="toc-text">django发送邮件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E7%9B%B8%E5%85%B3%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">邮件相关协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django%E5%8F%91%E9%82%AE%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">Django发邮件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number"></span> <span class="toc-text">项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#uWSGI"><span class="toc-number">1.</span> <span class="toc-text">uWSGI</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/a34e.html" title="使用WebAssembly优化性能问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kiftravel.oss-cn-beijing.aliyuncs.com/img/202309021720156.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用WebAssembly优化性能问题"/></a><div class="content"><a class="title" href="/post/a34e.html" title="使用WebAssembly优化性能问题">使用WebAssembly优化性能问题</a><time datetime="2023-09-02T05:47:00.000Z" title="发表于 2023-09-02 13:47:00">2023-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/kif1.html" title="Math.toFixed中的四舍五入问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kiftravel.oss-cn-beijing.aliyuncs.com/img/202308280943672.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Math.toFixed中的四舍五入问题"/></a><div class="content"><a class="title" href="/post/kif1.html" title="Math.toFixed中的四舍五入问题">Math.toFixed中的四舍五入问题</a><time datetime="2023-08-28T03:09:00.000Z" title="发表于 2023-08-28 11:09:00">2023-08-28</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/post/8a59.html" title="React系列：Rematch">React系列：Rematch</a><time datetime="2023-08-05T03:31:00.000Z" title="发表于 2023-08-05 11:31:00">2023-08-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/9aee.html" title="kif的neovim设置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/img/202304191059908.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kif的neovim设置"/></a><div class="content"><a class="title" href="/post/9aee.html" title="kif的neovim设置">kif的neovim设置</a><time datetime="2023-04-19T02:58:00.000Z" title="发表于 2023-04-19 10:58:00">2023-04-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/5fbb.html" title="win11中powershell设置v2ray代理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifimg.oss-cn-beijing.aliyuncs.com/img/202304191057671.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="win11中powershell设置v2ray代理"/></a><div class="content"><a class="title" href="/post/5fbb.html" title="win11中powershell设置v2ray代理">win11中powershell设置v2ray代理</a><time datetime="2023-04-19T02:54:00.000Z" title="发表于 2023-04-19 10:54:00">2023-04-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2023 By <a class="footer-bar-link" href="/" title="kif" target="_blank">kif</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">17</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.kifroom.icu/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/ico.png" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://kifnav.kifroom.icu/" title="kifNav"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://kifnav.kifroom.icu/favicon.ico" alt="kifNav"/><span class="back-menu-item-text">kifNav</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/links/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/message-board/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/travel/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 游记</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Axios/" style="font-size: 0.88rem;">Axios<sup>3</sup></a><a href="/tags/C-S-N/" style="font-size: 0.88rem;">C.S.N<sup>1</sup></a><a href="/tags/Ckeditor4/" style="font-size: 0.88rem;">Ckeditor4<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>3</sup></a><a href="/tags/Django/" style="font-size: 0.88rem;">Django<sup>1</sup></a><a href="/tags/Excel/" style="font-size: 0.88rem;">Excel<sup>1</sup></a><a href="/tags/Oracle/" style="font-size: 0.88rem;">Oracle<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>1</sup></a><a href="/tags/RSA/" style="font-size: 0.88rem;">RSA<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>1</sup></a><a href="/tags/VS-code/" style="font-size: 0.88rem;">VS code<sup>1</sup></a><a href="/tags/Vue-js/" style="font-size: 0.88rem;">Vue.js<sup>2</sup></a><a href="/tags/Win/" style="font-size: 0.88rem;">Win<sup>3</sup></a><a href="/tags/dom-to-image/" style="font-size: 0.88rem;">dom-to-image<sup>1</sup></a><a href="/tags/express/" style="font-size: 0.88rem;">express<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>5</sup></a><a href="/tags/javascript/" style="font-size: 0.88rem;">javascript<sup>7</sup></a><a href="/tags/kali/" style="font-size: 0.88rem;">kali<sup>1</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>1</sup></a><a href="/tags/lerna/" style="font-size: 0.88rem;">lerna<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/matery/" style="font-size: 0.88rem;">matery<sup>2</sup></a><a href="/tags/monorepo/" style="font-size: 0.88rem;">monorepo<sup>1</sup></a><a href="/tags/node-js/" style="font-size: 0.88rem;">node.js<sup>2</sup></a><a href="/tags/pinia/" style="font-size: 0.88rem;">pinia<sup>1</sup></a><a href="/tags/pyqt/" style="font-size: 0.88rem;">pyqt<sup>1</sup></a><a href="/tags/this/" style="font-size: 0.88rem;">this<sup>1</sup></a><a href="/tags/vite/" style="font-size: 0.88rem;">vite<sup>2</sup></a><a href="/tags/vue3/" style="font-size: 0.88rem;">vue3<sup>3</sup></a><a href="/tags/webpack/" style="font-size: 0.88rem;">webpack<sup>1</sup></a><a href="/tags/workspace/" style="font-size: 0.88rem;">workspace<sup>1</sup></a><a href="/tags/%E5%85%BC%E5%AE%B9%E6%80%A7/" style="font-size: 0.88rem;">兼容性<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">开发规范<sup>2</sup></a><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 0.88rem;">微信小程序<sup>4</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size: 0.88rem;">数组<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%AB%99%E4%BE%BF%E7%AD%BE/" style="font-size: 0.88rem;">网站便签<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.5",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 kif 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'b7AAVOuWhWIEQsQfviV12FRp-gzGzoHsz',
      appKey: 'TYFSaiPIN5WAmTU3nv8wG8wb',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://b7AAVOuW.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'b7AAVOuWhWIEQsQfviV12FRp-gzGzoHsz',
        "X-LC-Key": 'TYFSaiPIN5WAmTU3nv8wG8wb',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "kif101001000@163.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>